<!doctype html>
<head><meta charset="utf-8">
<title>Iterator Helpers</title><script>'use strict';
let sdoBox = {
  init() {
    this.$alternativeId = null;
    this.$outer = document.createElement('div');
    this.$outer.classList.add('toolbox-container');
    this.$container = document.createElement('div');
    this.$container.classList.add('toolbox');
    this.$displayLink = document.createElement('a');
    this.$displayLink.setAttribute('href', '#');
    this.$displayLink.textContent = 'Syntax-Directed Operations';
    this.$displayLink.addEventListener('click', e => {
      e.preventDefault();
      e.stopPropagation();
      referencePane.showSDOs(sdoMap[this.$alternativeId] || {}, this.$alternativeId);
    });
    this.$container.appendChild(this.$displayLink);
    this.$outer.appendChild(this.$container);
    document.body.appendChild(this.$outer);
  },

  activate(el) {
    clearTimeout(this.deactiveTimeout);
    Toolbox.deactivate();
    this.$alternativeId = el.id;
    let numSdos = Object.keys(sdoMap[this.$alternativeId] || {}).length;
    this.$displayLink.textContent = 'Syntax-Directed Operations (' + numSdos + ')';
    this.$outer.classList.add('active');
    let top = el.offsetTop - this.$outer.offsetHeight;
    let left = el.offsetLeft + 50 - 10; // 50px = padding-left(=75px) + text-indent(=-25px)
    this.$outer.setAttribute('style', 'left: ' + left + 'px; top: ' + top + 'px');
    if (top < document.body.scrollTop) {
      this.$container.scrollIntoView();
    }
  },

  deactivate() {
    clearTimeout(this.deactiveTimeout);
    this.$outer.classList.remove('active');
  },
};

document.addEventListener('DOMContentLoaded', () => {
  if (typeof sdoMap == 'undefined') {
    console.error('could not find sdo map');
    return;
  }
  sdoBox.init();

  let insideTooltip = false;
  sdoBox.$outer.addEventListener('pointerenter', () => {
    insideTooltip = true;
  });
  sdoBox.$outer.addEventListener('pointerleave', () => {
    insideTooltip = false;
    sdoBox.deactivate();
  });

  sdoBox.deactiveTimeout = null;
  [].forEach.call(document.querySelectorAll('emu-grammar[type=definition] emu-rhs'), node => {
    node.addEventListener('pointerenter', function () {
      sdoBox.activate(this);
    });

    node.addEventListener('pointerleave', () => {
      sdoBox.deactiveTimeout = setTimeout(() => {
        if (!insideTooltip) {
          sdoBox.deactivate();
        }
      }, 500);
    });
  });

  document.addEventListener(
    'keydown',
    debounce(e => {
      if (e.code === 'Escape') {
        sdoBox.deactivate();
      }
    })
  );
});

'use strict';
function Search(menu) {
  this.menu = menu;
  this.$search = document.getElementById('menu-search');
  this.$searchBox = document.getElementById('menu-search-box');
  this.$searchResults = document.getElementById('menu-search-results');

  this.loadBiblio();

  document.addEventListener('keydown', this.documentKeydown.bind(this));

  this.$searchBox.addEventListener(
    'keydown',
    debounce(this.searchBoxKeydown.bind(this), { stopPropagation: true })
  );
  this.$searchBox.addEventListener(
    'keyup',
    debounce(this.searchBoxKeyup.bind(this), { stopPropagation: true })
  );

  // Perform an initial search if the box is not empty.
  if (this.$searchBox.value) {
    this.search(this.$searchBox.value);
  }
}

Search.prototype.loadBiblio = function () {
  if (typeof biblio === 'undefined') {
    console.error('could not find biblio');
    this.biblio = { refToClause: {}, entries: [] };
  } else {
    this.biblio = biblio;
    this.biblio.clauses = this.biblio.entries.filter(e => e.type === 'clause');
    this.biblio.byId = this.biblio.entries.reduce((map, entry) => {
      map[entry.id] = entry;
      return map;
    }, {});
    let refParentClause = Object.create(null);
    this.biblio.refParentClause = refParentClause;
    let refsByClause = this.biblio.refsByClause;
    Object.keys(refsByClause).forEach(clause => {
      refsByClause[clause].forEach(ref => {
        refParentClause[ref] = clause;
      });
    });
  }
};

Search.prototype.documentKeydown = function (e) {
  if (e.key === '/') {
    e.preventDefault();
    e.stopPropagation();
    this.triggerSearch();
  }
};

Search.prototype.searchBoxKeydown = function (e) {
  e.stopPropagation();
  e.preventDefault();
  if (e.keyCode === 191 && e.target.value.length === 0) {
    e.preventDefault();
  } else if (e.keyCode === 13) {
    e.preventDefault();
    this.selectResult();
  }
};

Search.prototype.searchBoxKeyup = function (e) {
  if (e.keyCode === 13 || e.keyCode === 9) {
    return;
  }

  this.search(e.target.value);
};

Search.prototype.triggerSearch = function () {
  if (this.menu.isVisible()) {
    this._closeAfterSearch = false;
  } else {
    this._closeAfterSearch = true;
    this.menu.show();
  }

  this.$searchBox.focus();
  this.$searchBox.select();
};
// bit 12 - Set if the result starts with searchString
// bits 8-11: 8 - number of chunks multiplied by 2 if cases match, otherwise 1.
// bits 1-7: 127 - length of the entry
// General scheme: prefer case sensitive matches with fewer chunks, and otherwise
// prefer shorter matches.
function relevance(result) {
  let relevance = 0;

  relevance = Math.max(0, 8 - result.match.chunks) << 7;

  if (result.match.caseMatch) {
    relevance *= 2;
  }

  if (result.match.prefix) {
    relevance += 2048;
  }

  relevance += Math.max(0, 255 - result.key.length);

  return relevance;
}

Search.prototype.search = function (searchString) {
  if (searchString === '') {
    this.displayResults([]);
    this.hideSearch();
    return;
  } else {
    this.showSearch();
  }

  if (searchString.length === 1) {
    this.displayResults([]);
    return;
  }

  let results;

  if (/^[\d.]*$/.test(searchString)) {
    results = this.biblio.clauses
      .filter(clause => clause.number.substring(0, searchString.length) === searchString)
      .map(clause => ({ key: getKey(clause), entry: clause }));
  } else {
    results = [];

    for (let i = 0; i < this.biblio.entries.length; i++) {
      let entry = this.biblio.entries[i];
      let key = getKey(entry);
      if (!key) {
        // biblio entries without a key aren't searchable
        continue;
      }

      let match = fuzzysearch(searchString, key);
      if (match) {
        results.push({ key, entry, match });
      }
    }

    results.forEach(result => {
      result.relevance = relevance(result, searchString);
    });

    results = results.sort((a, b) => b.relevance - a.relevance);
  }

  if (results.length > 50) {
    results = results.slice(0, 50);
  }

  this.displayResults(results);
};
Search.prototype.hideSearch = function () {
  this.$search.classList.remove('active');
};

Search.prototype.showSearch = function () {
  this.$search.classList.add('active');
};

Search.prototype.selectResult = function () {
  let $first = this.$searchResults.querySelector('li:first-child a');

  if ($first) {
    document.location = $first.getAttribute('href');
  }

  this.$searchBox.value = '';
  this.$searchBox.blur();
  this.displayResults([]);
  this.hideSearch();

  if (this._closeAfterSearch) {
    this.menu.hide();
  }
};

Search.prototype.displayResults = function (results) {
  if (results.length > 0) {
    this.$searchResults.classList.remove('no-results');

    let html = '<ul>';

    results.forEach(result => {
      let key = result.key;
      let entry = result.entry;
      let id = entry.id;
      let cssClass = '';
      let text = '';

      if (entry.type === 'clause') {
        let number = entry.number ? entry.number + ' ' : '';
        text = number + key;
        cssClass = 'clause';
        id = entry.id;
      } else if (entry.type === 'production') {
        text = key;
        cssClass = 'prod';
        id = entry.id;
      } else if (entry.type === 'op') {
        text = key;
        cssClass = 'op';
        id = entry.id || entry.refId;
      } else if (entry.type === 'term') {
        text = key;
        cssClass = 'term';
        id = entry.id || entry.refId;
      }

      if (text) {
        // prettier-ignore
        html += `<li class=menu-search-result-${cssClass}><a href="${makeLinkToId(id)}">${text}</a></li>`;
      }
    });

    html += '</ul>';

    this.$searchResults.innerHTML = html;
  } else {
    this.$searchResults.innerHTML = '';
    this.$searchResults.classList.add('no-results');
  }
};

function getKey(item) {
  if (item.key) {
    return item.key;
  }
  switch (item.type) {
    case 'clause':
      return item.title || item.titleHTML;
    case 'production':
      return item.name;
    case 'op':
      return item.aoid;
    case 'term':
      return item.term;
    case 'table':
    case 'figure':
    case 'example':
    case 'note':
      return item.caption;
    case 'step':
      return item.id;
    default:
      throw new Error("Can't get key for " + item.type);
  }
}

function Menu() {
  this.$toggle = document.getElementById('menu-toggle');
  this.$menu = document.getElementById('menu');
  this.$toc = document.querySelector('menu-toc > ol');
  this.$pins = document.querySelector('#menu-pins');
  this.$pinList = document.getElementById('menu-pins-list');
  this.$toc = document.querySelector('#menu-toc > ol');
  this.$specContainer = document.getElementById('spec-container');
  this.search = new Search(this);

  this._pinnedIds = {};
  this.loadPinEntries();

  // toggle menu
  this.$toggle.addEventListener('click', this.toggle.bind(this));

  // keydown events for pinned clauses
  document.addEventListener('keydown', this.documentKeydown.bind(this));

  // toc expansion
  let tocItems = this.$menu.querySelectorAll('#menu-toc li');
  for (let i = 0; i < tocItems.length; i++) {
    let $item = tocItems[i];
    $item.addEventListener('click', event => {
      $item.classList.toggle('active');
      event.stopPropagation();
    });
  }

  // close toc on toc item selection
  let tocLinks = this.$menu.querySelectorAll('#menu-toc li > a');
  for (let i = 0; i < tocLinks.length; i++) {
    let $link = tocLinks[i];
    $link.addEventListener('click', event => {
      this.toggle();
      event.stopPropagation();
    });
  }

  // update active clause on scroll
  window.addEventListener('scroll', debounce(this.updateActiveClause.bind(this)));
  this.updateActiveClause();

  // prevent menu scrolling from scrolling the body
  this.$toc.addEventListener('wheel', e => {
    let target = e.currentTarget;
    let offTop = e.deltaY < 0 && target.scrollTop === 0;
    if (offTop) {
      e.preventDefault();
    }
    let offBottom = e.deltaY > 0 && target.offsetHeight + target.scrollTop >= target.scrollHeight;

    if (offBottom) {
      e.preventDefault();
    }
  });
}

Menu.prototype.documentKeydown = function (e) {
  e.stopPropagation();
  if (e.keyCode === 80) {
    this.togglePinEntry();
  } else if (e.keyCode > 48 && e.keyCode < 58) {
    this.selectPin(e.keyCode - 49);
  }
};

Menu.prototype.updateActiveClause = function () {
  this.setActiveClause(findActiveClause(this.$specContainer));
};

Menu.prototype.setActiveClause = function (clause) {
  this.$activeClause = clause;
  this.revealInToc(this.$activeClause);
};

Menu.prototype.revealInToc = function (path) {
  let current = this.$toc.querySelectorAll('li.revealed');
  for (let i = 0; i < current.length; i++) {
    current[i].classList.remove('revealed');
    current[i].classList.remove('revealed-leaf');
  }

  current = this.$toc;
  let index = 0;
  outer: while (index < path.length) {
    let children = current.children;
    for (let i = 0; i < children.length; i++) {
      if ('#' + path[index].id === children[i].children[1].hash) {
        children[i].classList.add('revealed');
        if (index === path.length - 1) {
          children[i].classList.add('revealed-leaf');
          let rect = children[i].getBoundingClientRect();
          // this.$toc.getBoundingClientRect().top;
          let tocRect = this.$toc.getBoundingClientRect();
          if (rect.top + 10 > tocRect.bottom) {
            this.$toc.scrollTop =
              this.$toc.scrollTop + (rect.top - tocRect.bottom) + (rect.bottom - rect.top);
          } else if (rect.top < tocRect.top) {
            this.$toc.scrollTop = this.$toc.scrollTop - (tocRect.top - rect.top);
          }
        }
        current = children[i].querySelector('ol');
        index++;
        continue outer;
      }
    }
    console.log('could not find location in table of contents', path);
    break;
  }
};

function findActiveClause(root, path) {
  let clauses = getChildClauses(root);
  path = path || [];

  for (let $clause of clauses) {
    let rect = $clause.getBoundingClientRect();
    let $header = $clause.querySelector('h1');
    let marginTop = Math.max(
      parseInt(getComputedStyle($clause)['margin-top']),
      parseInt(getComputedStyle($header)['margin-top'])
    );

    if (rect.top - marginTop <= 1 && rect.bottom > 0) {
      return findActiveClause($clause, path.concat($clause)) || path;
    }
  }

  return path;
}

function* getChildClauses(root) {
  for (let el of root.children) {
    switch (el.nodeName) {
      // descend into <emu-import>
      case 'EMU-IMPORT':
        yield* getChildClauses(el);
        break;

      // accept <emu-clause>, <emu-intro>, and <emu-annex>
      case 'EMU-CLAUSE':
      case 'EMU-INTRO':
      case 'EMU-ANNEX':
        yield el;
    }
  }
}

Menu.prototype.toggle = function () {
  this.$menu.classList.toggle('active');
};

Menu.prototype.show = function () {
  this.$menu.classList.add('active');
};

Menu.prototype.hide = function () {
  this.$menu.classList.remove('active');
};

Menu.prototype.isVisible = function () {
  return this.$menu.classList.contains('active');
};

Menu.prototype.showPins = function () {
  this.$pins.classList.add('active');
};

Menu.prototype.hidePins = function () {
  this.$pins.classList.remove('active');
};

Menu.prototype.addPinEntry = function (id) {
  let entry = this.search.biblio.byId[id];
  if (!entry) {
    // id was deleted after pin (or something) so remove it
    delete this._pinnedIds[id];
    this.persistPinEntries();
    return;
  }

  if (entry.type === 'clause') {
    let prefix;
    if (entry.number) {
      prefix = entry.number + ' ';
    } else {
      prefix = '';
    }
    // prettier-ignore
    this.$pinList.innerHTML += `<li><a href="${makeLinkToId(entry.id)}">${prefix}${entry.titleHTML}</a></li>`;
  } else {
    this.$pinList.innerHTML += `<li><a href="${makeLinkToId(entry.id)}">${getKey(entry)}</a></li>`;
  }

  if (Object.keys(this._pinnedIds).length === 0) {
    this.showPins();
  }
  this._pinnedIds[id] = true;
  this.persistPinEntries();
};

Menu.prototype.removePinEntry = function (id) {
  let item = this.$pinList.querySelector(`a[href="${makeLinkToId(id)}"]`).parentNode;
  this.$pinList.removeChild(item);
  delete this._pinnedIds[id];
  if (Object.keys(this._pinnedIds).length === 0) {
    this.hidePins();
  }

  this.persistPinEntries();
};

Menu.prototype.persistPinEntries = function () {
  try {
    if (!window.localStorage) return;
  } catch (e) {
    return;
  }

  localStorage.pinEntries = JSON.stringify(Object.keys(this._pinnedIds));
};

Menu.prototype.loadPinEntries = function () {
  try {
    if (!window.localStorage) return;
  } catch (e) {
    return;
  }

  let pinsString = window.localStorage.pinEntries;
  if (!pinsString) return;
  let pins = JSON.parse(pinsString);
  for (let i = 0; i < pins.length; i++) {
    this.addPinEntry(pins[i]);
  }
};

Menu.prototype.togglePinEntry = function (id) {
  if (!id) {
    id = this.$activeClause[this.$activeClause.length - 1].id;
  }

  if (this._pinnedIds[id]) {
    this.removePinEntry(id);
  } else {
    this.addPinEntry(id);
  }
};

Menu.prototype.selectPin = function (num) {
  document.location = this.$pinList.children[num].children[0].href;
};

let menu;

document.addEventListener('DOMContentLoaded', init);

function debounce(fn, opts) {
  opts = opts || {};
  let timeout;
  return function (e) {
    if (opts.stopPropagation) {
      e.stopPropagation();
    }
    let args = arguments;
    if (timeout) {
      clearTimeout(timeout);
    }
    timeout = setTimeout(() => {
      timeout = null;
      fn.apply(this, args);
    }, 150);
  };
}

let CLAUSE_NODES = ['EMU-CLAUSE', 'EMU-INTRO', 'EMU-ANNEX'];
function findContainer($elem) {
  let parentClause = $elem.parentNode;
  while (parentClause && CLAUSE_NODES.indexOf(parentClause.nodeName) === -1) {
    parentClause = parentClause.parentNode;
  }
  return parentClause;
}

function findLocalReferences(parentClause, name) {
  let vars = parentClause.querySelectorAll('var');
  let references = [];

  for (let i = 0; i < vars.length; i++) {
    let $var = vars[i];

    if ($var.innerHTML === name) {
      references.push($var);
    }
  }

  return references;
}

let REFERENCED_CLASSES = Array.from({ length: 7 }, (x, i) => `referenced${i}`);
function chooseHighlightIndex(parentClause) {
  let counts = REFERENCED_CLASSES.map($class => parentClause.getElementsByClassName($class).length);
  // Find the earliest index with the lowest count.
  let minCount = Infinity;
  let index = null;
  for (let i = 0; i < counts.length; i++) {
    if (counts[i] < minCount) {
      minCount = counts[i];
      index = i;
    }
  }
  return index;
}

function toggleFindLocalReferences($elem) {
  let parentClause = findContainer($elem);
  let references = findLocalReferences(parentClause, $elem.innerHTML);
  if ($elem.classList.contains('referenced')) {
    references.forEach($reference => {
      $reference.classList.remove('referenced', ...REFERENCED_CLASSES);
    });
  } else {
    let index = chooseHighlightIndex(parentClause);
    references.forEach($reference => {
      $reference.classList.add('referenced', `referenced${index}`);
    });
  }
}

function installFindLocalReferences() {
  document.addEventListener('click', e => {
    if (e.target.nodeName === 'VAR') {
      toggleFindLocalReferences(e.target);
    }
  });
}

document.addEventListener('DOMContentLoaded', installFindLocalReferences);

// The following license applies to the fuzzysearch function
// The MIT License (MIT)
// Copyright © 2015 Nicolas Bevacqua
// Copyright © 2016 Brian Terlson
// Permission is hereby granted, free of charge, to any person obtaining a copy of
// this software and associated documentation files (the "Software"), to deal in
// the Software without restriction, including without limitation the rights to
// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
// the Software, and to permit persons to whom the Software is furnished to do so,
// subject to the following conditions:

// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
// FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
// IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
function fuzzysearch(searchString, haystack, caseInsensitive) {
  let tlen = haystack.length;
  let qlen = searchString.length;
  let chunks = 1;
  let finding = false;

  if (qlen > tlen) {
    return false;
  }

  if (qlen === tlen) {
    if (searchString === haystack) {
      return { caseMatch: true, chunks: 1, prefix: true };
    } else if (searchString.toLowerCase() === haystack.toLowerCase()) {
      return { caseMatch: false, chunks: 1, prefix: true };
    } else {
      return false;
    }
  }

  let j = 0;
  outer: for (let i = 0; i < qlen; i++) {
    let nch = searchString[i];
    while (j < tlen) {
      let targetChar = haystack[j++];
      if (targetChar === nch) {
        finding = true;
        continue outer;
      }
      if (finding) {
        chunks++;
        finding = false;
      }
    }

    if (caseInsensitive) {
      return false;
    }

    return fuzzysearch(searchString.toLowerCase(), haystack.toLowerCase(), true);
  }

  return { caseMatch: !caseInsensitive, chunks, prefix: j <= qlen };
}

let referencePane = {
  init() {
    this.$container = document.createElement('div');
    this.$container.setAttribute('id', 'references-pane-container');

    let $spacer = document.createElement('div');
    $spacer.setAttribute('id', 'references-pane-spacer');

    this.$pane = document.createElement('div');
    this.$pane.setAttribute('id', 'references-pane');

    this.$container.appendChild($spacer);
    this.$container.appendChild(this.$pane);

    this.$header = document.createElement('div');
    this.$header.classList.add('menu-pane-header');
    this.$headerText = document.createElement('span');
    this.$header.appendChild(this.$headerText);
    this.$headerRefId = document.createElement('a');
    this.$header.appendChild(this.$headerRefId);
    this.$closeButton = document.createElement('span');
    this.$closeButton.setAttribute('id', 'references-pane-close');
    this.$closeButton.addEventListener('click', () => {
      this.deactivate();
    });
    this.$header.appendChild(this.$closeButton);

    this.$pane.appendChild(this.$header);
    let tableContainer = document.createElement('div');
    tableContainer.setAttribute('id', 'references-pane-table-container');

    this.$table = document.createElement('table');
    this.$table.setAttribute('id', 'references-pane-table');

    this.$tableBody = this.$table.createTBody();

    tableContainer.appendChild(this.$table);
    this.$pane.appendChild(tableContainer);

    menu.$specContainer.appendChild(this.$container);
  },

  activate() {
    this.$container.classList.add('active');
  },

  deactivate() {
    this.$container.classList.remove('active');
    this.state = null;
  },

  showReferencesFor(entry) {
    this.activate();
    this.state = { type: 'ref', id: entry.id };
    this.$headerText.textContent = 'References to ';
    let newBody = document.createElement('tbody');
    let previousId;
    let previousCell;
    let dupCount = 0;
    this.$headerRefId.textContent = '#' + entry.id;
    this.$headerRefId.setAttribute('href', makeLinkToId(entry.id));
    this.$headerRefId.style.display = 'inline';
    (entry.referencingIds || [])
      .map(id => {
        let cid = menu.search.biblio.refParentClause[id];
        let clause = menu.search.biblio.byId[cid];
        if (clause == null) {
          throw new Error('could not find clause for id ' + cid);
        }
        return { id, clause };
      })
      .sort((a, b) => sortByClauseNumber(a.clause, b.clause))
      .forEach(record => {
        if (previousId === record.clause.id) {
          previousCell.innerHTML += ` (<a href="${makeLinkToId(record.id)}">${dupCount + 2}</a>)`;
          dupCount++;
        } else {
          let row = newBody.insertRow();
          let cell = row.insertCell();
          cell.innerHTML = record.clause.number;
          cell = row.insertCell();
          cell.innerHTML = `<a href="${makeLinkToId(record.id)}">${record.clause.titleHTML}</a>`;
          previousCell = cell;
          previousId = record.clause.id;
          dupCount = 0;
        }
      }, this);
    this.$table.removeChild(this.$tableBody);
    this.$tableBody = newBody;
    this.$table.appendChild(this.$tableBody);
  },

  showSDOs(sdos, alternativeId) {
    let rhs = document.getElementById(alternativeId);
    let parentName = rhs.parentNode.getAttribute('name');
    let colons = rhs.parentNode.querySelector('emu-geq');
    rhs = rhs.cloneNode(true);
    rhs.querySelectorAll('emu-params,emu-constraints').forEach(e => {
      e.remove();
    });
    rhs.querySelectorAll('[id]').forEach(e => {
      e.removeAttribute('id');
    });
    rhs.querySelectorAll('a').forEach(e => {
      e.parentNode.replaceChild(document.createTextNode(e.textContent), e);
    });

    // prettier-ignore
    this.$headerText.innerHTML = `Syntax-Directed Operations for<br><a href="${makeLinkToId(alternativeId)}" class="menu-pane-header-production"><emu-nt>${parentName}</emu-nt> ${colons.outerHTML} </a>`;
    this.$headerText.querySelector('a').append(rhs);
    this.showSDOsBody(sdos, alternativeId);
  },

  showSDOsBody(sdos, alternativeId) {
    this.activate();
    this.state = { type: 'sdo', id: alternativeId, html: this.$headerText.innerHTML };
    this.$headerRefId.style.display = 'none';
    let newBody = document.createElement('tbody');
    Object.keys(sdos).forEach(sdoName => {
      let pair = sdos[sdoName];
      let clause = pair.clause;
      let ids = pair.ids;
      let first = ids[0];
      let row = newBody.insertRow();
      let cell = row.insertCell();
      cell.innerHTML = clause;
      cell = row.insertCell();
      let html = '<a href="' + makeLinkToId(first) + '">' + sdoName + '</a>';
      for (let i = 1; i < ids.length; ++i) {
        html += ' (<a href="' + makeLinkToId(ids[i]) + '">' + (i + 1) + '</a>)';
      }
      cell.innerHTML = html;
    });
    this.$table.removeChild(this.$tableBody);
    this.$tableBody = newBody;
    this.$table.appendChild(this.$tableBody);
  },
};

let Toolbox = {
  init() {
    this.$outer = document.createElement('div');
    this.$outer.classList.add('toolbox-container');
    this.$container = document.createElement('div');
    this.$container.classList.add('toolbox');
    this.$outer.appendChild(this.$container);
    this.$permalink = document.createElement('a');
    this.$permalink.textContent = 'Permalink';
    this.$pinLink = document.createElement('a');
    this.$pinLink.textContent = 'Pin';
    this.$pinLink.setAttribute('href', '#');
    this.$pinLink.addEventListener('click', e => {
      e.preventDefault();
      e.stopPropagation();
      menu.togglePinEntry(this.entry.id);
      this.$pinLink.textContent = menu._pinnedIds[this.entry.id] ? 'Unpin' : 'Pin';
    });

    this.$refsLink = document.createElement('a');
    this.$refsLink.setAttribute('href', '#');
    this.$refsLink.addEventListener('click', e => {
      e.preventDefault();
      e.stopPropagation();
      referencePane.showReferencesFor(this.entry);
    });
    this.$container.appendChild(this.$permalink);
    this.$container.appendChild(this.$pinLink);
    this.$container.appendChild(this.$refsLink);
    document.body.appendChild(this.$outer);
  },

  activate(el, entry, target) {
    if (el === this._activeEl) return;
    sdoBox.deactivate();
    this.active = true;
    this.entry = entry;
    this.$pinLink.textContent = menu._pinnedIds[entry.id] ? 'Unpin' : 'Pin';
    this.$outer.classList.add('active');
    this.top = el.offsetTop - this.$outer.offsetHeight;
    this.left = el.offsetLeft - 10;
    this.$outer.setAttribute('style', 'left: ' + this.left + 'px; top: ' + this.top + 'px');
    this.updatePermalink();
    this.updateReferences();
    this._activeEl = el;
    if (this.top < document.body.scrollTop && el === target) {
      // don't scroll unless it's a small thing (< 200px)
      this.$outer.scrollIntoView();
    }
  },

  updatePermalink() {
    this.$permalink.setAttribute('href', makeLinkToId(this.entry.id));
  },

  updateReferences() {
    this.$refsLink.textContent = `References (${(this.entry.referencingIds || []).length})`;
  },

  activateIfMouseOver(e) {
    let ref = this.findReferenceUnder(e.target);
    if (ref && (!this.active || e.pageY > this._activeEl.offsetTop)) {
      let entry = menu.search.biblio.byId[ref.id];
      this.activate(ref.element, entry, e.target);
    } else if (
      this.active &&
      (e.pageY < this.top || e.pageY > this._activeEl.offsetTop + this._activeEl.offsetHeight)
    ) {
      this.deactivate();
    }
  },

  findReferenceUnder(el) {
    while (el) {
      let parent = el.parentNode;
      if (el.nodeName === 'EMU-RHS' || el.nodeName === 'EMU-PRODUCTION') {
        return null;
      }
      if (
        el.nodeName === 'H1' &&
        parent.nodeName.match(/EMU-CLAUSE|EMU-ANNEX|EMU-INTRO/) &&
        parent.id
      ) {
        return { element: el, id: parent.id };
      } else if (el.nodeName === 'EMU-NT') {
        if (
          parent.nodeName === 'EMU-PRODUCTION' &&
          parent.id &&
          parent.id[0] !== '_' &&
          parent.firstElementChild === el
        ) {
          // return the LHS non-terminal element
          return { element: el, id: parent.id };
        }
        return null;
      } else if (
        el.nodeName.match(/EMU-(?!CLAUSE|XREF|ANNEX|INTRO)|DFN/) &&
        el.id &&
        el.id[0] !== '_'
      ) {
        if (
          el.nodeName === 'EMU-FIGURE' ||
          el.nodeName === 'EMU-TABLE' ||
          el.nodeName === 'EMU-EXAMPLE'
        ) {
          // return the figcaption element
          return { element: el.children[0].children[0], id: el.id };
        } else {
          return { element: el, id: el.id };
        }
      }
      el = parent;
    }
  },

  deactivate() {
    this.$outer.classList.remove('active');
    this._activeEl = null;
    this.active = false;
  },
};

function sortByClauseNumber(clause1, clause2) {
  let c1c = clause1.number.split('.');
  let c2c = clause2.number.split('.');

  for (let i = 0; i < c1c.length; i++) {
    if (i >= c2c.length) {
      return 1;
    }

    let c1 = c1c[i];
    let c2 = c2c[i];
    let c1cn = Number(c1);
    let c2cn = Number(c2);

    if (Number.isNaN(c1cn) && Number.isNaN(c2cn)) {
      if (c1 > c2) {
        return 1;
      } else if (c1 < c2) {
        return -1;
      }
    } else if (!Number.isNaN(c1cn) && Number.isNaN(c2cn)) {
      return -1;
    } else if (Number.isNaN(c1cn) && !Number.isNaN(c2cn)) {
      return 1;
    } else if (c1cn > c2cn) {
      return 1;
    } else if (c1cn < c2cn) {
      return -1;
    }
  }

  if (c1c.length === c2c.length) {
    return 0;
  }
  return -1;
}

function makeLinkToId(id) {
  let hash = '#' + id;
  if (typeof idToSection === 'undefined' || !idToSection[id]) {
    return hash;
  }
  let targetSec = idToSection[id];
  return (targetSec === 'index' ? './' : targetSec + '.html') + hash;
}

function doShortcut(e) {
  if (!(e.target instanceof HTMLElement)) {
    return;
  }
  let target = e.target;
  let name = target.nodeName.toLowerCase();
  if (name === 'textarea' || name === 'input' || name === 'select' || target.isContentEditable) {
    return;
  }
  if (e.altKey || e.ctrlKey || e.metaKey) {
    return;
  }
  if (e.key === 'm' && usesMultipage) {
    let pathParts = location.pathname.split('/');
    let hash = location.hash;
    if (pathParts[pathParts.length - 2] === 'multipage') {
      if (hash === '') {
        let sectionName = pathParts[pathParts.length - 1];
        if (sectionName.endsWith('.html')) {
          sectionName = sectionName.slice(0, -5);
        }
        if (idToSection['sec-' + sectionName] !== undefined) {
          hash = '#sec-' + sectionName;
        }
      }
      location = pathParts.slice(0, -2).join('/') + '/' + hash;
    } else {
      location = 'multipage/' + hash;
    }
  } else if (e.key === 'u') {
    document.documentElement.classList.toggle('show-ao-annotations');
  } else if (e.key === '?') {
    document.getElementById('shortcuts-help').classList.toggle('active');
  }
}

function init() {
  menu = new Menu();
  let $container = document.getElementById('spec-container');
  $container.addEventListener(
    'mouseover',
    debounce(e => {
      Toolbox.activateIfMouseOver(e);
    })
  );
  document.addEventListener(
    'keydown',
    debounce(e => {
      if (e.code === 'Escape') {
        if (Toolbox.active) {
          Toolbox.deactivate();
        }
        document.getElementById('shortcuts-help').classList.remove('active');
      }
    })
  );
}

document.addEventListener('keypress', doShortcut);

document.addEventListener('DOMContentLoaded', () => {
  Toolbox.init();
  referencePane.init();
});

// preserve state during navigation

function getTocPath(li) {
  let path = [];
  let pointer = li;
  while (true) {
    let parent = pointer.parentElement;
    if (parent == null) {
      return null;
    }
    let index = [].indexOf.call(parent.children, pointer);
    if (index == -1) {
      return null;
    }
    path.unshift(index);
    pointer = parent.parentElement;
    if (pointer == null) {
      return null;
    }
    if (pointer.id === 'menu-toc') {
      break;
    }
    if (pointer.tagName !== 'LI') {
      return null;
    }
  }
  return path;
}

function activateTocPath(path) {
  try {
    let pointer = document.getElementById('menu-toc');
    for (let index of path) {
      pointer = pointer.querySelector('ol').children[index];
    }
    pointer.classList.add('active');
  } catch (e) {
    // pass
  }
}

function getActiveTocPaths() {
  return [...menu.$menu.querySelectorAll('.active')].map(getTocPath).filter(p => p != null);
}

function loadStateFromSessionStorage() {
  if (!window.sessionStorage || typeof menu === 'undefined' || window.navigating) {
    return;
  }
  if (sessionStorage.referencePaneState != null) {
    let state = JSON.parse(sessionStorage.referencePaneState);
    if (state != null) {
      if (state.type === 'ref') {
        let entry = menu.search.biblio.byId[state.id];
        if (entry != null) {
          referencePane.showReferencesFor(entry);
        }
      } else if (state.type === 'sdo') {
        let sdos = sdoMap[state.id];
        if (sdos != null) {
          referencePane.$headerText.innerHTML = state.html;
          referencePane.showSDOsBody(sdos, state.id);
        }
      }
      delete sessionStorage.referencePaneState;
    }
  }

  if (sessionStorage.activeTocPaths != null) {
    document
      .getElementById('menu-toc')
      .querySelectorAll('.active')
      .forEach(e => {
        e.classList.remove('active');
      });
    let active = JSON.parse(sessionStorage.activeTocPaths);
    active.forEach(activateTocPath);
    delete sessionStorage.activeTocPaths;
  }

  if (sessionStorage.searchValue != null) {
    let value = JSON.parse(sessionStorage.searchValue);
    menu.search.$searchBox.value = value;
    menu.search.search(value);
    delete sessionStorage.searchValue;
  }

  if (sessionStorage.tocScroll != null) {
    let tocScroll = JSON.parse(sessionStorage.tocScroll);
    menu.$toc.scrollTop = tocScroll;
    delete sessionStorage.tocScroll;
  }
}

document.addEventListener('DOMContentLoaded', loadStateFromSessionStorage);

window.addEventListener('pageshow', loadStateFromSessionStorage);

window.addEventListener('beforeunload', () => {
  if (!window.sessionStorage || typeof menu === 'undefined') {
    return;
  }
  sessionStorage.referencePaneState = JSON.stringify(referencePane.state || null);
  sessionStorage.activeTocPaths = JSON.stringify(getActiveTocPaths());
  sessionStorage.searchValue = JSON.stringify(menu.search.$searchBox.value);
  sessionStorage.tocScroll = JSON.stringify(menu.$toc.scrollTop);
});

'use strict';
let decimalBullet = Array.from({ length: 100 }, (a, i) => '' + (i + 1));
let alphaBullet = Array.from({ length: 26 }, (a, i) => String.fromCharCode('a'.charCodeAt(0) + i));

// prettier-ignore
let romanBullet = ['i', 'ii', 'iii', 'iv', 'v', 'vi', 'vii', 'viii', 'ix', 'x', 'xi', 'xii', 'xiii', 'xiv', 'xv', 'xvi', 'xvii', 'xviii', 'xix', 'xx', 'xxi', 'xxii', 'xxiii', 'xxiv', 'xxv'];
// prettier-ignore
let bullets = [decimalBullet, alphaBullet, romanBullet, decimalBullet, alphaBullet, romanBullet];

function addStepNumberText(ol, parentIndex) {
  for (let i = 0; i < ol.children.length; ++i) {
    let child = ol.children[i];
    let index = parentIndex.concat([i]);
    let applicable = bullets[Math.min(index.length - 1, 5)];
    let span = document.createElement('span');
    span.textContent = (applicable[i] || '?') + '. ';
    span.style.fontSize = '0';
    span.setAttribute('aria-hidden', 'true');
    child.prepend(span);
    let sublist = child.querySelector('ol');
    if (sublist != null) {
      addStepNumberText(sublist, index);
    }
  }
}
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('emu-alg > ol').forEach(ol => {
    addStepNumberText(ol, []);
  });
});

let sdoMap = JSON.parse(`{}`);
let biblio = JSON.parse(`{"refsByClause":{"sec-well-known-intrinsic-objects":["_ref_0","_ref_1","_ref_2","_ref_3","_ref_4","_ref_5","_ref_6","_ref_7","_ref_8","_ref_9"],"sec-ifabruptcloseasynciterator":["_ref_10"],"sec-iterator.prototype":["_ref_11"],"sec-iterator.from":["_ref_12","_ref_13","_ref_14"],"sec-wrapforvaliditeratorprototype-object":["_ref_15"],"sec-asynciterator.prototype":["_ref_16"],"sec-asynciterator.from":["_ref_17","_ref_18","_ref_19"],"sec-wrapforvalidasynciteratorprototype-object":["_ref_20"],"sec-iterator-helper-objects":["_ref_21","_ref_22","_ref_23","_ref_24"],"sec-%iteratorhelperprototype%-object":["_ref_25","_ref_26"],"sec-async-iterator-helper-objects":["_ref_27","_ref_28","_ref_29","_ref_30"],"sec-%asynciteratorhelperprototype%-object":["_ref_31","_ref_32"],"sec-iteratorprototype.constructor":["_ref_33","_ref_34"],"sec-iteratorprototype.map":["_ref_35","_ref_36","_ref_37"],"sec-iteratorprototype.filter":["_ref_38","_ref_39","_ref_40"],"sec-iteratorprototype.take":["_ref_41","_ref_42","_ref_43"],"sec-iteratorprototype.drop":["_ref_44","_ref_45","_ref_46","_ref_47"],"sec-iteratorprototype.asindexedpairs":["_ref_48","_ref_49","_ref_50"],"sec-iteratorprototype.flatmap":["_ref_51","_ref_52","_ref_53"],"sec-iteratorprototype.reduce":["_ref_54","_ref_55","_ref_56"],"sec-iteratorprototype.toarray":["_ref_57","_ref_58"],"sec-iteratorprototype.foreach":["_ref_59","_ref_60"],"sec-iteratorprototype.some":["_ref_61","_ref_62"],"sec-iteratorprototype.every":["_ref_63","_ref_64"],"sec-iteratorprototype.find":["_ref_65","_ref_66"],"sec-iteratorprototype-@@tostringtag":["_ref_67"],"sec-asynciteratorprototype.constructor":["_ref_68","_ref_69"],"sec-asynciteratorprototype.map":["_ref_70","_ref_71","_ref_72","_ref_73","_ref_74"],"sec-asynciteratorprototype.filter":["_ref_75","_ref_76","_ref_77","_ref_78","_ref_79"],"sec-asynciteratorprototype.take":["_ref_80","_ref_81","_ref_82"],"sec-asynciteratorprototype.drop":["_ref_83","_ref_84","_ref_85"],"sec-asynciteratorprototype.asindexedpairs":["_ref_86","_ref_87","_ref_88"],"sec-asynciteratorprototype.flatmap":["_ref_89","_ref_90","_ref_91","_ref_92","_ref_93","_ref_94","_ref_95","_ref_96","_ref_97","_ref_98","_ref_99"],"sec-asynciteratorprototype.reduce":["_ref_100","_ref_101","_ref_102"],"sec-asynciteratorprototype.toarray":["_ref_103","_ref_104"],"sec-asynciteratorprototype.foreach":["_ref_105","_ref_106","_ref_107","_ref_108"],"sec-asynciteratorprototype.some":["_ref_109","_ref_110","_ref_111","_ref_112"],"sec-asynciteratorprototype.every":["_ref_113","_ref_114","_ref_115","_ref_116"],"sec-asynciteratorprototype.find":["_ref_117","_ref_118","_ref_119","_ref_120"],"sec-asynciteratorprototype-@@tostringtag":["_ref_121"]},"entries":[{"type":"table","id":"table-7","number":1,"caption":"Table 1: Well-Known Intrinsic Objects"},{"type":"clause","id":"sec-well-known-intrinsic-objects","titleHTML":"Well-Known Intrinsic Objects","number":"1"},{"type":"op","aoid":"GetIteratorDirect","refId":"sec-getiteratordirect"},{"type":"clause","id":"sec-getiteratordirect","title":"GetIteratorDirect ( obj )","titleHTML":"GetIteratorDirect ( <var>obj</var> )","number":"2.1.1","referencingIds":["_ref_13","_ref_18","_ref_35","_ref_38","_ref_41","_ref_44","_ref_48","_ref_51","_ref_54","_ref_57","_ref_59","_ref_61","_ref_63","_ref_65","_ref_70","_ref_75","_ref_80","_ref_83","_ref_86","_ref_90","_ref_100","_ref_104","_ref_106","_ref_110","_ref_114","_ref_118"]},{"type":"op","aoid":"IteratorStep","refId":"sec-iteratorstep"},{"type":"clause","id":"sec-iteratorstep","title":"IteratorStep ( iteratorRecord [ , value ] )","titleHTML":"IteratorStep ( <var>iteratorRecord</var> <ins>[ , <var>value</var> ]</ins> )","number":"2.1.2","referencingIds":["_ref_36","_ref_39","_ref_42","_ref_45","_ref_46","_ref_49","_ref_52","_ref_55","_ref_56","_ref_58","_ref_60","_ref_62","_ref_64","_ref_66"]},{"type":"clause","id":"sec-operations-on-iterator-objects","titleHTML":"Operations on Iterator Objects","number":"2.1"},{"type":"clause","id":"sec-abstract-operations","titleHTML":"Abstract Operations","number":"2"},{"type":"op","aoid":"IfAbruptCloseAsyncIterator","refId":"sec-ifabruptcloseasynciterator"},{"type":"clause","id":"sec-ifabruptcloseasynciterator","title":"IfAbruptCloseAsyncIterator ( value, iteratorRecord )","titleHTML":"IfAbruptCloseAsyncIterator ( <var>value</var>, <var>iteratorRecord</var> )","number":"3.1.1.1","referencingIds":["_ref_10","_ref_71","_ref_72","_ref_73","_ref_76","_ref_77","_ref_78","_ref_81","_ref_84","_ref_87","_ref_91","_ref_92","_ref_93","_ref_94","_ref_95","_ref_96","_ref_97","_ref_98","_ref_101","_ref_102","_ref_107","_ref_108","_ref_111","_ref_112","_ref_115","_ref_116","_ref_119","_ref_120"]},{"type":"clause","id":"sec-iterator-abstract-operations","titleHTML":"Iterator Abstract Operations","number":"3.1.1"},{"type":"term","term":"Iterator","refId":"sec-iterator-constructor"},{"type":"term","term":"%Iterator%","refId":"sec-iterator-constructor"},{"type":"clause","id":"sec-iterator","titleHTML":"Iterator ( )","number":"3.1.2.1.1"},{"type":"clause","id":"sec-iterator-constructor","titleHTML":"The Iterator Constructor","number":"3.1.2.1","referencingIds":["_ref_1","_ref_6","_ref_8","_ref_12","_ref_21","_ref_22","_ref_23","_ref_24","_ref_25","_ref_27","_ref_28","_ref_29","_ref_31","_ref_34","_ref_67","_ref_121"]},{"type":"clause","id":"sec-iterator.prototype","titleHTML":"Iterator.prototype","number":"3.1.2.2.1"},{"type":"term","term":"%WrapForValidIteratorPrototype%","refId":"sec-wrapforvaliditeratorprototype-object"},{"type":"clause","id":"sec-wrapforvaliditeratorprototype.next","title":"%WrapForValidIteratorPrototype%.next ( value )","titleHTML":"%WrapForValidIteratorPrototype%.next ( <var>value</var> )","number":"3.1.2.2.2.1.1"},{"type":"clause","id":"sec-wrapforvaliditeratorprototype.return","title":"%WrapForValidIteratorPrototype%.return ( v )","titleHTML":"%WrapForValidIteratorPrototype%.return ( <var>v</var> )","number":"3.1.2.2.2.1.2"},{"type":"clause","id":"sec-wrapforvaliditeratorprototype.throw","title":"%WrapForValidIteratorPrototype%.throw ( v )","titleHTML":"%WrapForValidIteratorPrototype%.throw ( <var>v</var> )","number":"3.1.2.2.2.1.3"},{"type":"clause","id":"sec-wrapforvaliditeratorprototype-object","titleHTML":"The %WrapForValidIteratorPrototype% Object","number":"3.1.2.2.2.1","referencingIds":["_ref_14"]},{"type":"clause","id":"sec-iterator.from","title":"Iterator.from ( O )","titleHTML":"Iterator.from ( <var>O</var> )","number":"3.1.2.2.2"},{"type":"clause","id":"sec-properties-of-the-iterator-constructor","titleHTML":"Properties of the Iterator Constructor","number":"3.1.2.2"},{"type":"clause","id":"sec-iterator-objects","titleHTML":"Iterator Objects","number":"3.1.2"},{"type":"term","term":"AsyncIterator","refId":"sec-asynciterator-constructor"},{"type":"term","term":"%AsyncIterator%","refId":"sec-asynciterator-constructor"},{"type":"clause","id":"sec-asynciterator","titleHTML":"AsyncIterator ( )","number":"3.1.3.1.1"},{"type":"clause","id":"sec-asynciterator-constructor","titleHTML":"The AsyncIterator Constructor","number":"3.1.3.1","referencingIds":["_ref_0","_ref_2","_ref_4","_ref_30","_ref_69"]},{"type":"clause","id":"sec-asynciterator.prototype","titleHTML":"AsyncIterator.prototype","number":"3.1.3.2.1"},{"type":"term","term":"%WrapForValidAsyncIteratorPrototype%","refId":"sec-wrapforvalidasynciteratorprototype-object"},{"type":"clause","id":"sec-wrapforvalidasynciteratorprototype.next","title":"%WrapForValidAsyncIteratorPrototype%.next ( value )","titleHTML":"%WrapForValidAsyncIteratorPrototype%.next ( <var>value</var> )","number":"3.1.3.2.2.1.1"},{"type":"clause","id":"sec-wrapforvalidasynciteratorprototype.return","title":"%WrapForValidAsyncIteratorPrototype%.return ( v )","titleHTML":"%WrapForValidAsyncIteratorPrototype%.return ( <var>v</var> )","number":"3.1.3.2.2.1.2"},{"type":"clause","id":"sec-wrapforvalidasynciteratorprototype.throw","title":"%WrapForValidAsyncIteratorPrototype%.throw ( v )","titleHTML":"%WrapForValidAsyncIteratorPrototype%.throw ( <var>v</var> )","number":"3.1.3.2.2.1.3"},{"type":"clause","id":"sec-wrapforvalidasynciteratorprototype-object","titleHTML":"The %WrapForValidAsyncIteratorPrototype% Object","number":"3.1.3.2.2.1","referencingIds":["_ref_19"]},{"type":"clause","id":"sec-asynciterator.from","title":"AsyncIterator.from ( O )","titleHTML":"AsyncIterator.from ( <var>O</var> )","number":"3.1.3.2.2"},{"type":"clause","id":"sec-properties-of-the-asynciterator-constructor","titleHTML":"Properties of the AsyncIterator Constructor","number":"3.1.3.2"},{"type":"clause","id":"sec-asynciterator-objects","titleHTML":"AsyncIterator Objects","number":"3.1.3"},{"type":"term","term":"%IteratorHelperPrototype%","refId":"sec-%iteratorhelperprototype%-object"},{"type":"clause","id":"sec-%iteratorhelperprototype%.next","title":"%IteratorHelperPrototype%.next ( value )","titleHTML":"%IteratorHelperPrototype%.next ( <var>value</var> )","number":"3.1.4.1.1"},{"type":"clause","id":"sec-%iteratorhelperprototype%.return","title":"%IteratorHelperPrototype%.return ( value )","titleHTML":"%IteratorHelperPrototype%.return ( <var>value</var> )","number":"3.1.4.1.2"},{"type":"clause","id":"sec-%iteratorhelperprototype%.throw","title":"%IteratorHelperPrototype%.throw ( exception )","titleHTML":"%IteratorHelperPrototype%.throw ( <var>exception</var> )","number":"3.1.4.1.3"},{"type":"clause","id":"sec-%iteratorhelperprototype%-@@tostringtag","titleHTML":"%IteratorHelperPrototype% [ @@toStringTag ]","number":"3.1.4.1.4"},{"type":"clause","id":"sec-%iteratorhelperprototype%-object","titleHTML":"The %IteratorHelperPrototype% Object","number":"3.1.4.1","referencingIds":["_ref_37","_ref_40","_ref_43","_ref_47","_ref_50","_ref_53"]},{"type":"clause","id":"sec-iterator-helper-objects","titleHTML":"Iterator Helper Objects","number":"3.1.4"},{"type":"term","term":"%AsyncIteratorHelperPrototype%","refId":"sec-%asynciteratorhelperprototype%-object"},{"type":"clause","id":"sec-%asynciteratorhelperprototype%.next","title":"%AsyncIteratorHelperPrototype%.next ( value )","titleHTML":"%AsyncIteratorHelperPrototype%.next ( <var>value</var> )","number":"3.1.5.1.1"},{"type":"clause","id":"sec-%asynciteratorhelperprototype%.return","title":"%AsyncIteratorHelperPrototype%.return ( value )","titleHTML":"%AsyncIteratorHelperPrototype%.return ( <var>value</var> )","number":"3.1.5.1.2"},{"type":"clause","id":"sec-%asynciteratorhelperprototype%.throw","title":"%AsyncIteratorHelperPrototype%.throw ( exception )","titleHTML":"%AsyncIteratorHelperPrototype%.throw ( <var>exception</var> )","number":"3.1.5.1.3"},{"type":"clause","id":"sec-%asynciteratorhelperprototype%-@@tostringtag","titleHTML":"%AsyncIteratorHelperPrototype% [ @@toStringTag ]","number":"3.1.5.1.4"},{"type":"clause","id":"sec-%asynciteratorhelperprototype%-object","titleHTML":"The %AsyncIteratorHelperPrototype% Object","number":"3.1.5.1","referencingIds":["_ref_74","_ref_79","_ref_82","_ref_85","_ref_88","_ref_99"]},{"type":"clause","id":"sec-async-iterator-helper-objects","titleHTML":"Async Iterator Helper Objects","number":"3.1.5"},{"type":"term","term":"%Iterator.prototype%","refId":"sec-%iteratorprototype%-object"},{"type":"clause","id":"sec-iteratorprototype.constructor","titleHTML":"%Iterator.prototype%.constructor","number":"3.1.6.1"},{"type":"clause","id":"sec-iteratorprototype.map","title":"%Iterator.prototype%.map ( mapper )","titleHTML":"%Iterator.prototype%.map ( <var>mapper</var> )","number":"3.1.6.2"},{"type":"clause","id":"sec-iteratorprototype.filter","title":"%Iterator.prototype%.filter ( filterer )","titleHTML":"%Iterator.prototype%.filter ( <var>filterer</var> )","number":"3.1.6.3"},{"type":"clause","id":"sec-iteratorprototype.take","title":"%Iterator.prototype%.take ( limit )","titleHTML":"%Iterator.prototype%.take ( <var>limit</var> )","number":"3.1.6.4"},{"type":"clause","id":"sec-iteratorprototype.drop","title":"%Iterator.prototype%.drop ( limit )","titleHTML":"%Iterator.prototype%.drop ( <var>limit</var> )","number":"3.1.6.5"},{"type":"clause","id":"sec-iteratorprototype.asindexedpairs","titleHTML":"%Iterator.prototype%.asIndexedPairs ( )","number":"3.1.6.6"},{"type":"clause","id":"sec-iteratorprototype.flatmap","title":"%Iterator.prototype%.flatMap ( mapper )","titleHTML":"%Iterator.prototype%.flatMap ( <var>mapper</var> )","number":"3.1.6.7"},{"type":"clause","id":"sec-iteratorprototype.reduce","title":"%Iterator.prototype%.reduce ( reducer [ , initialValue ] )","titleHTML":"%Iterator.prototype%.reduce ( <var>reducer</var> [ , <var>initialValue</var> ] )","number":"3.1.6.8"},{"type":"clause","id":"sec-iteratorprototype.toarray","titleHTML":"%Iterator.prototype%.toArray ( )","number":"3.1.6.9"},{"type":"clause","id":"sec-iteratorprototype.foreach","title":"%Iterator.prototype%.forEach ( fn )","titleHTML":"%Iterator.prototype%.forEach ( <var>fn</var> )","number":"3.1.6.10"},{"type":"clause","id":"sec-iteratorprototype.some","title":"%Iterator.prototype%.some ( fn )","titleHTML":"%Iterator.prototype%.some ( <var>fn</var> )","number":"3.1.6.11"},{"type":"clause","id":"sec-iteratorprototype.every","title":"%Iterator.prototype%.every ( fn )","titleHTML":"%Iterator.prototype%.every ( <var>fn</var> )","number":"3.1.6.12"},{"type":"clause","id":"sec-iteratorprototype.find","title":"%Iterator.prototype%.find ( fn )","titleHTML":"%Iterator.prototype%.find ( <var>fn</var> )","number":"3.1.6.13"},{"type":"clause","id":"sec-iteratorprototype-@@tostringtag","titleHTML":"%Iterator.prototype% [ @@toStringTag ]","number":"3.1.6.14"},{"type":"clause","id":"sec-%iteratorprototype%-object","title":"The %Iterator.prototype% Object","titleHTML":"The <dfn>%Iterator.prototype%</dfn> Object","number":"3.1.6","referencingIds":["_ref_7","_ref_9","_ref_11","_ref_15","_ref_26","_ref_33"]},{"type":"term","term":"%AsyncIterator.prototype%","refId":"sec-asynciteratorprototype"},{"type":"clause","id":"sec-asynciteratorprototype.constructor","titleHTML":"%AsyncIterator.prototype%.constructor","number":"3.1.7.1"},{"type":"clause","id":"sec-asynciteratorprototype.map","title":"%AsyncIterator.prototype%.map ( mapper )","titleHTML":"%AsyncIterator.prototype%.map ( <var>mapper</var> )","number":"3.1.7.2"},{"type":"clause","id":"sec-asynciteratorprototype.filter","title":"%AsyncIterator.prototype%.filter ( filterer )","titleHTML":"%AsyncIterator.prototype%.filter ( <var>filterer</var> )","number":"3.1.7.3"},{"type":"clause","id":"sec-asynciteratorprototype.take","title":"%AsyncIterator.prototype%.take ( limit )","titleHTML":"%AsyncIterator.prototype%.take ( <var>limit</var> )","number":"3.1.7.4"},{"type":"clause","id":"sec-asynciteratorprototype.drop","title":"%AsyncIterator.prototype%.drop ( limit )","titleHTML":"%AsyncIterator.prototype%.drop ( <var>limit</var> )","number":"3.1.7.5"},{"type":"clause","id":"sec-asynciteratorprototype.asindexedpairs","titleHTML":"%AsyncIterator.prototype%.asIndexedPairs ( )","number":"3.1.7.6"},{"type":"clause","id":"sec-asynciteratorprototype.flatmap","title":"%AsyncIterator.prototype%.flatMap ( mapper )","titleHTML":"%AsyncIterator.prototype%.flatMap ( <var>mapper</var> )","number":"3.1.7.7"},{"type":"clause","id":"sec-asynciteratorprototype.reduce","title":"%AsyncIterator.prototype%.reduce ( reducer [ , initialValue ] )","titleHTML":"%AsyncIterator.prototype%.reduce ( <var>reducer</var> [ , <var>initialValue</var> ] )","number":"3.1.7.8"},{"type":"clause","id":"sec-asynciteratorprototype.toarray","titleHTML":"%AsyncIterator.prototype%.toArray ( )","number":"3.1.7.9"},{"type":"clause","id":"sec-asynciteratorprototype.foreach","title":"%AsyncIterator.prototype%.forEach ( fn )","titleHTML":"%AsyncIterator.prototype%.forEach ( <var>fn</var> )","number":"3.1.7.10"},{"type":"clause","id":"sec-asynciteratorprototype.some","title":"%AsyncIterator.prototype%.some ( fn )","titleHTML":"%AsyncIterator.prototype%.some ( <var>fn</var> )","number":"3.1.7.11"},{"type":"clause","id":"sec-asynciteratorprototype.every","title":"%AsyncIterator.prototype%.every ( fn )","titleHTML":"%AsyncIterator.prototype%.every ( <var>fn</var> )","number":"3.1.7.12"},{"type":"clause","id":"sec-asynciteratorprototype.find","title":"%AsyncIterator.prototype%.find ( fn )","titleHTML":"%AsyncIterator.prototype%.find ( <var>fn</var> )","number":"3.1.7.13"},{"type":"clause","id":"sec-asynciteratorprototype-@@tostringtag","titleHTML":"%AsyncIterator.prototype% [ @@toStringTag ]","number":"3.1.7.14"},{"type":"clause","id":"sec-asynciteratorprototype","title":"The %AsyncIterator.prototype% Object","titleHTML":"The <dfn>%AsyncIterator.prototype%</dfn> Object","number":"3.1.7","referencingIds":["_ref_3","_ref_5","_ref_16","_ref_17","_ref_20","_ref_32","_ref_68","_ref_89","_ref_103","_ref_105","_ref_109","_ref_113","_ref_117"]},{"type":"clause","id":"sec-%asyncfromsynciteratorprototype%.next","title":"%AsyncFromSyncIteratorPrototype%.next ( value )","titleHTML":"%AsyncFromSyncIteratorPrototype%.next ( <var>value</var> )","number":"3.1.8.1"},{"type":"clause","id":"sec-%asyncfromsynciteratorprototype%.return","title":"%AsyncFromSyncIteratorPrototype%.return ( value )","titleHTML":"%AsyncFromSyncIteratorPrototype%.return ( <var>value</var> )","number":"3.1.8.2"},{"type":"clause","id":"sec-%asyncfromsynciteratorprototype%.throw","title":"%AsyncFromSyncIteratorPrototype%.throw ( value )","titleHTML":"%AsyncFromSyncIteratorPrototype%.throw ( <var>value</var> )","number":"3.1.8.3"},{"type":"clause","id":"sec-%asyncfromsynciteratorprototype%-object","titleHTML":"The %AsyncFromSyncIteratorPrototype% Object","number":"3.1.8"},{"type":"clause","id":"sec-iteration","titleHTML":"Iteration","number":"3.1"},{"type":"clause","id":"sec-control-abstraction-objects","titleHTML":"Control Abstraction Objects","number":"3"}]}`);
;let usesMultipage = false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/base16/solarized-light.min.css"><style>body {
  display: flex;
  font-size: 18px;
  line-height: 1.5;
  font-family: Cambria, Palatino Linotype, Palatino, Liberation Serif, serif;
  padding: 0;
  margin: 0;
  color: #111;
}

#spec-container {
  padding: 0 20px;
  flex-grow: 1;
  flex-basis: 66%;
  box-sizing: border-box;
  overflow: hidden;
  padding-bottom: 1em;
}

body.oldtoc {
  margin: 0 auto;
}

a {
  text-decoration: none;
  color: #206ca7;
}

a:visited {
  color: #206ca7;
}

a:hover {
  text-decoration: underline;
  color: #239dee;
}

a.e-user-code,
span.e-user-code {
  white-space: nowrap;
}

a.e-user-code::before,
span.e-user-code::before {
  display: none;
  color: brown;
  background-color: white;
  border: 2pt solid brown;
  padding: 0.3ex;
  margin: 0 0.25em 0 0;
  line-height: 1;
  vertical-align: text-top;
  text-transform: uppercase;
  font-family: 'Comic Code', sans-serif;
  font-weight: 900;
  font-size: x-small;
}

a.e-user-code:hover::before,
span.e-user-code:hover::before {
  background-color: brown;
  color: white;
}

html.show-ao-annotations a.e-user-code::before,
html.show-ao-annotations span.e-user-code::before {
  display: inline-block;
}

a.e-user-code::before,
span.e-user-code::before {
  content: 'UC';
}

code {
  font-weight: bold;
  font-family: Consolas, Monaco, monospace;
  white-space: pre;
}

pre code {
  font-weight: inherit;
}

pre code.hljs {
  background-color: #fff;
  margin: 0;
  padding: 0;
}

ol.toc {
  list-style: none;
  padding-left: 0;
}

ol.toc ol.toc {
  padding-left: 2ex;
  list-style: none;
}

var {
  color: #2aa198;
  transition: background-color 0.25s ease;
  cursor: pointer;
}

var.referenced0 {
  color: inherit;
  background-color: #ffff33;
  box-shadow: 0 0 0 2px #ffff33;
}
var.referenced1 {
  color: inherit;
  background-color: #ff87a2;
  box-shadow: 0 0 0 2px #ff87a2;
}
var.referenced2 {
  color: inherit;
  background-color: #96e885;
  box-shadow: 0 0 0 2px #96e885;
}
var.referenced3 {
  color: inherit;
  background-color: #3eeed2;
  box-shadow: 0 0 0 2px #3eeed2;
}
var.referenced4 {
  color: inherit;
  background-color: #eacfb6;
  box-shadow: 0 0 0 2px #eacfb6;
}
var.referenced5 {
  color: inherit;
  background-color: #82ddff;
  box-shadow: 0 0 0 2px #82ddff;
}
var.referenced6 {
  color: inherit;
  background-color: #ffbcf2;
  box-shadow: 0 0 0 2px #ffbcf2;
}

emu-const {
  font-family: sans-serif;
}

emu-val {
  font-weight: bold;
}

/* depth 1 */
emu-alg ol,
/* depth 4 */
emu-alg ol ol ol ol,
emu-alg ol.nested-thrice,
emu-alg ol.nested-twice ol,
emu-alg ol.nested-once ol ol {
  list-style-type: decimal;
}

/* depth 2 */
emu-alg ol ol,
emu-alg ol.nested-once,
/* depth 5 */
emu-alg ol ol ol ol ol,
emu-alg ol.nested-four-times,
emu-alg ol.nested-thrice ol,
emu-alg ol.nested-twice ol ol,
emu-alg ol.nested-once ol ol ol {
  list-style-type: lower-alpha;
}

/* depth 3 */
emu-alg ol ol ol,
emu-alg ol.nested-twice,
emu-alg ol.nested-once ol,
/* depth 6 */
emu-alg ol ol ol ol ol ol,
emu-alg ol.nested-lots,
emu-alg ol.nested-four-times ol,
emu-alg ol.nested-thrice ol ol,
emu-alg ol.nested-twice ol ol ol,
emu-alg ol.nested-once ol ol ol ol,
/* depth 7+ */
emu-alg ol.nested-lots ol {
  list-style-type: lower-roman;
}

emu-eqn {
  display: block;
  margin-left: 4em;
}

emu-eqn.inline {
  display: inline;
  margin: 0;
}

emu-eqn div:first-child {
  margin-left: -2em;
}

emu-note {
  margin: 1em 0;
  display: flex;
  flex-direction: row;
  color: inherit;
  border-left: 5px solid #52e052;
  background: #e9fbe9;
  padding: 10px 10px 10px 0;
}

emu-note > span.note {
  flex-basis: 100px;
  min-width: 100px;
  flex-grow: 0;
  flex-shrink: 1;
  text-transform: uppercase;
  padding-left: 5px;
}

emu-note[type='editor'] {
  border-left-color: #faa;
}

emu-note > div.note-contents {
  flex-grow: 1;
  flex-shrink: 1;
  overflow: auto;
}

emu-note > div.note-contents > p:first-of-type {
  margin-top: 0;
}

emu-note > div.note-contents > p:last-of-type {
  margin-bottom: 0;
}

emu-table td code {
  white-space: normal;
}

emu-figure {
  display: block;
}

emu-example {
  display: block;
  margin: 1em 3em;
}

emu-example figure figcaption {
  margin-top: 0.5em;
  text-align: left;
}

emu-figure figure,
emu-example figure,
emu-table figure {
  display: flex;
  flex-direction: column;
  align-items: center;
}

emu-production {
  display: block;
}

emu-grammar[type='example'] emu-production,
emu-grammar[type='definition'] emu-production {
  margin-top: 1em;
  margin-bottom: 1em;
  margin-left: 5ex;
}

emu-grammar.inline,
emu-production.inline,
emu-grammar.inline emu-production emu-rhs,
emu-production.inline emu-rhs,
emu-grammar[collapsed] emu-production emu-rhs {
  display: inline;
  padding-left: 1ex;
  margin-left: 0;
}

emu-production[collapsed] emu-rhs {
  display: inline;
  padding-left: 0.5ex;
  margin-left: 0;
}

emu-grammar[collapsed] emu-production,
emu-production[collapsed] {
  margin: 0;
}

emu-constraints {
  font-size: 0.75em;
  margin-right: 0.5ex;
}

emu-gann {
  margin-right: 0.5ex;
}

emu-gann emu-t:last-child,
emu-gann emu-gprose:last-child,
emu-gann emu-nt:last-child {
  margin-right: 0;
}

emu-geq {
  margin-left: 0.5ex;
  font-weight: bold;
}

emu-oneof {
  font-weight: bold;
  margin-left: 0.5ex;
}

emu-nt {
  display: inline-block;
  font-style: italic;
  white-space: nowrap;
  text-indent: 0;
}

emu-nt a,
emu-nt a:visited {
  color: #333;
}

emu-rhs emu-nt {
  margin-right: 0.5ex;
}

emu-t {
  display: inline-block;
  font-family: monospace;
  font-weight: bold;
  white-space: nowrap;
  text-indent: 0;
}

emu-production emu-t {
  margin-right: 0.5ex;
}

emu-rhs {
  display: block;
  padding-left: 75px;
  text-indent: -25px;
}

emu-production:not([collapsed]) emu-rhs {
  border: 0.2ex dashed transparent;
}

emu-production:not([collapsed]) emu-rhs:hover {
  border-color: #888;
  background-color: #f0f0f0;
}

emu-mods {
  font-size: 0.85em;
  vertical-align: sub;
  font-style: normal;
  font-weight: normal;
}

emu-params,
emu-opt {
  margin-right: 1ex;
  font-family: monospace;
}

emu-params,
emu-constraints {
  color: #2aa198;
}

emu-opt {
  color: #b58900;
}

emu-gprose {
  font-size: 0.9em;
  font-family: Helvetica, Arial, sans-serif;
}

emu-production emu-gprose {
  margin-right: 1ex;
}

h1.shortname {
  color: #f60;
  font-size: 1.5em;
  margin: 0;
}

h1.version {
  color: #f60;
  font-size: 1.5em;
}

h1.title {
  color: #f60;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  position: relative;
}

h1 .secnum {
  text-decoration: none;
  margin-right: 5px;
}

h1 span.title {
  order: 2;
}

h1 {
  font-size: 2.67em;
  margin-bottom: 0;
  line-height: 1em;
}
h2 {
  font-size: 2em;
}
h3 {
  font-size: 1.56em;
}
h4 {
  font-size: 1.25em;
}
h5 {
  font-size: 1.11em;
}
h6 {
  font-size: 1em;
}

pre code.hljs {
  background: transparent;
}

emu-clause[id],
emu-annex[id],
emu-intro[id] {
  scroll-margin-top: 2ex;
}

emu-intro h1,
emu-clause h1,
emu-annex h1 {
  font-size: 2em;
}
emu-intro h2,
emu-clause h2,
emu-annex h2 {
  font-size: 1.56em;
}
emu-intro h3,
emu-clause h3,
emu-annex h3 {
  font-size: 1.25em;
}
emu-intro h4,
emu-clause h4,
emu-annex h4 {
  font-size: 1.11em;
}
emu-intro h5,
emu-clause h5,
emu-annex h5 {
  font-size: 1em;
}
emu-intro h6,
emu-clause h6,
emu-annex h6 {
  font-size: 0.9em;
}
emu-intro emu-intro h1,
emu-clause emu-clause h1,
emu-annex emu-annex h1 {
  font-size: 1.56em;
}
emu-intro emu-intro h2,
emu-clause emu-clause h2,
emu-annex emu-annex h2 {
  font-size: 1.25em;
}
emu-intro emu-intro h3,
emu-clause emu-clause h3,
emu-annex emu-annex h3 {
  font-size: 1.11em;
}
emu-intro emu-intro h4,
emu-clause emu-clause h4,
emu-annex emu-annex h4 {
  font-size: 1em;
}
emu-intro emu-intro h5,
emu-clause emu-clause h5,
emu-annex emu-annex h5 {
  font-size: 0.9em;
}
emu-intro emu-intro emu-intro h1,
emu-clause emu-clause emu-clause h1,
emu-annex emu-annex emu-annex h1 {
  font-size: 1.25em;
}
emu-intro emu-intro emu-intro h2,
emu-clause emu-clause emu-clause h2,
emu-annex emu-annex emu-annex h2 {
  font-size: 1.11em;
}
emu-intro emu-intro emu-intro h3,
emu-clause emu-clause emu-clause h3,
emu-annex emu-annex emu-annex h3 {
  font-size: 1em;
}
emu-intro emu-intro emu-intro h4,
emu-clause emu-clause emu-clause h4,
emu-annex emu-annex emu-annex h4 {
  font-size: 0.9em;
}
emu-intro emu-intro emu-intro emu-intro h1,
emu-clause emu-clause emu-clause emu-clause h1,
emu-annex emu-annex emu-annex emu-annex h1 {
  font-size: 1.11em;
}
emu-intro emu-intro emu-intro emu-intro h2,
emu-clause emu-clause emu-clause emu-clause h2,
emu-annex emu-annex emu-annex emu-annex h2 {
  font-size: 1em;
}
emu-intro emu-intro emu-intro emu-intro h3,
emu-clause emu-clause emu-clause emu-clause h3,
emu-annex emu-annex emu-annex emu-annex h3 {
  font-size: 0.9em;
}
emu-intro emu-intro emu-intro emu-intro emu-intro h1,
emu-clause emu-clause emu-clause emu-clause emu-clause h1,
emu-annex emu-annex emu-annex emu-annex emu-annex h1 {
  font-size: 1em;
}
emu-intro emu-intro emu-intro emu-intro emu-intro h2,
emu-clause emu-clause emu-clause emu-clause emu-clause h2,
emu-annex emu-annex emu-annex emu-annex emu-annex h2 {
  font-size: 0.9em;
}
emu-intro emu-intro emu-intro emu-intro emu-intro emu-intro h1,
emu-clause emu-clause emu-clause emu-clause emu-clause emu-clause h1,
emu-annex emu-annex emu-annex emu-annex emu-annex emu-annex h1 {
  font-size: 0.9em;
}

emu-clause,
emu-intro,
emu-annex {
  display: block;
}

/* these values are twice the font-size for the <h1> titles for clauses */
emu-intro,
emu-clause,
emu-annex {
  margin-top: 4em;
}
emu-intro emu-intro,
emu-clause emu-clause,
emu-annex emu-annex {
  margin-top: 3.12em;
}
emu-intro emu-intro emu-intro,
emu-clause emu-clause emu-clause,
emu-annex emu-annex emu-annex {
  margin-top: 2.5em;
}
emu-intro emu-intro emu-intro emu-intro,
emu-clause emu-clause emu-clause emu-clause,
emu-annex emu-annex emu-annex emu-annex {
  margin-top: 2.22em;
}
emu-intro emu-intro emu-intro emu-intro emu-intro,
emu-clause emu-clause emu-clause emu-clause emu-clause,
emu-annex emu-annex emu-annex emu-annex emu-annex {
  margin-top: 2em;
}
emu-intro emu-intro emu-intro emu-intro emu-intro emu-intro,
emu-clause emu-clause emu-clause emu-clause emu-clause emu-clause,
emu-annex emu-annex emu-annex emu-annex emu-annex emu-annex {
  margin-top: 1.8em;
}

#spec-container > emu-intro:first-of-type,
#spec-container > emu-clause:first-of-type,
#spec-container > emu-annex:first-of-type {
  margin-top: 0;
}

/* Figures and tables */
figure {
  display: block;
  margin: 1em 0 3em 0;
}
figure object {
  display: block;
  margin: 0 auto;
}
figure table.real-table {
  margin: 0 auto;
}
figure figcaption {
  display: block;
  color: #555555;
  font-weight: bold;
  text-align: center;
}

emu-table table {
  margin: 0 auto;
}

emu-table table,
table.real-table {
  border-collapse: collapse;
}

emu-table td,
emu-table th,
table.real-table td,
table.real-table th {
  border: 1px solid black;
  padding: 0.4em;
  vertical-align: baseline;
}
emu-table th,
emu-table thead td,
table.real-table th {
  background-color: #eeeeee;
}

emu-table td {
  background: #fff;
}

/* Note: the left content edges of table.lightweight-table >tbody >tr >td
   and div.display line up. */
table.lightweight-table {
  border-collapse: collapse;
  margin: 0 0 0 1.5em;
}
table.lightweight-table td,
table.lightweight-table th {
  border: none;
  padding: 0 0.5em;
  vertical-align: baseline;
}

/* diff styles */
ins {
  background-color: #e0f8e0;
  text-decoration: none;
  border-bottom: 1px solid #396;
}

del {
  background-color: #fee;
}

ins.block,
del.block,
emu-production > ins,
emu-production > del,
emu-grammar > ins,
emu-grammar > del {
  display: block;
}
emu-rhs > ins,
emu-rhs > del {
  display: inline;
}

tr.ins > td > ins {
  border-bottom: none;
}

tr.ins > td {
  background-color: #e0f8e0;
}

tr.del > td {
  background-color: #fee;
}

/* Menu Styles */
#menu-toggle {
  font-size: 2em;

  position: fixed;
  top: 0;
  left: 0;
  width: 1.5em;
  height: 1.5em;
  z-index: 3;
  visibility: hidden;
  color: #1567a2;
  background-color: #fff;

  line-height: 1.5em;
  text-align: center;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;

  cursor: pointer;
}

#menu {
  display: flex;
  flex-direction: column;
  width: 33%;
  height: 100vh;
  max-width: 500px;
  box-sizing: border-box;
  background-color: #ddd;
  overflow: hidden;
  transition: opacity 0.1s linear;
  padding: 0 5px;
  position: fixed;
  left: 0;
  top: 0;
  border-right: 2px solid #bbb;

  z-index: 2;
}

#menu-spacer {
  flex-basis: 33%;
  max-width: 500px;
  flex-grow: 0;
  flex-shrink: 0;
}

#menu a {
  color: #1567a2;
}

#menu.active {
  display: flex;
  opacity: 1;
  z-index: 2;
}

#menu-pins {
  flex-grow: 1;
  display: none;
}

#menu-pins.active {
  display: block;
}

#menu-pins-list {
  margin: 0;
  padding: 0;
  counter-reset: pins-counter;
}

#menu-pins-list > li:before {
  content: counter(pins-counter);
  counter-increment: pins-counter;
  display: inline-block;
  width: 25px;
  text-align: center;
  border: 1px solid #bbb;
  padding: 2px;
  margin: 4px;
  box-sizing: border-box;
  line-height: 1em;
  background-color: #ccc;
  border-radius: 4px;
}
#menu-toc > ol {
  padding: 0;
  flex-grow: 1;
}

#menu-toc > ol li {
  padding: 0;
}

#menu-toc > ol,
#menu-toc > ol ol {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

#menu-toc > ol ol {
  padding-left: 0.75em;
}

#menu-toc li {
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

#menu-toc .item-toggle {
  display: inline-block;
  transform: rotate(-45deg) translate(-5px, -5px);
  transition: transform 0.1s ease;
  text-align: center;
  width: 20px;

  color: #aab;

  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;

  cursor: pointer;
}

#menu-toc .item-toggle-none {
  display: inline-block;
  width: 20px;
}

#menu-toc li.active > .item-toggle {
  transform: rotate(45deg) translate(-5px, -5px);
}

#menu-toc li > ol {
  display: none;
}

#menu-toc li.active > ol {
  display: block;
}

#menu-toc li.revealed > a {
  background-color: #bbb;
  font-weight: bold;
  /*
  background-color: #222;
  color: #c6d8e4;
  */
}

#menu-toc li.revealed-leaf > a {
  color: #206ca7;
  /*
  background-color: #222;
  color: #c6d8e4;
  */
}

#menu-toc li.revealed > .item-toggle {
  transform: rotate(45deg) translate(-5px, -5px);
}

#menu-toc li.revealed > ol {
  display: block;
}

#menu-toc li > a {
  padding: 2px 5px;
}

#menu > * {
  margin-bottom: 5px;
}

.menu-pane-header {
  padding: 0 5px;
  text-transform: uppercase;
  background-color: #aaa;
  color: #335;
  font-weight: bold;
  letter-spacing: 2px;
  flex-grow: 0;
  flex-shrink: 0;
  font-size: 0.8em;
}

.menu-pane-header emu-opt,
.menu-pane-header emu-t,
.menu-pane-header emu-nt {
  margin-right: 0px;
  display: inline;
  color: inherit;
}

.menu-pane-header emu-rhs {
  display: inline;
  padding-left: 0px;
  text-indent: 0px;
}

.menu-pane-header emu-geq {
  margin-left: 0px;
}

a.menu-pane-header-production {
  color: inherit;
}

.menu-pane-header-production {
  text-transform: none;
  letter-spacing: 1.5px;
  padding-left: 0.5em;
}

#menu-toc {
  display: flex;
  flex-direction: column;
  width: 100%;
  overflow: hidden;
  flex-grow: 1;
}

#menu-toc ol.toc {
  overflow-x: hidden;
  overflow-y: auto;
}

#menu-search {
  position: relative;
  flex-grow: 0;
  flex-shrink: 0;
  width: 100%;

  display: flex;
  flex-direction: column;

  max-height: 300px;
}

#menu-trace-list {
  display: none;
}

#menu-search-box {
  box-sizing: border-box;
  display: block;
  width: 100%;
  margin: 5px 0 0 0;
  font-size: 1em;
  padding: 2px;
  background-color: #bbb;
  border: 1px solid #999;
}

#menu-search-results {
  overflow-x: hidden;
  overflow-y: auto;
}

li.menu-search-result-clause:before {
  content: 'clause';
  width: 40px;
  display: inline-block;
  text-align: right;
  padding-right: 1ex;
  color: #666;
  font-size: 75%;
}
li.menu-search-result-op:before {
  content: 'op';
  width: 40px;
  display: inline-block;
  text-align: right;
  padding-right: 1ex;
  color: #666;
  font-size: 75%;
}

li.menu-search-result-prod:before {
  content: 'prod';
  width: 40px;
  display: inline-block;
  text-align: right;
  padding-right: 1ex;
  color: #666;
  font-size: 75%;
}

li.menu-search-result-term:before {
  content: 'term';
  width: 40px;
  display: inline-block;
  text-align: right;
  padding-right: 1ex;
  color: #666;
  font-size: 75%;
}

#menu-search-results ul {
  padding: 0 5px;
  margin: 0;
}

#menu-search-results li {
  white-space: nowrap;
  text-overflow: ellipsis;
}

#menu-trace-list {
  counter-reset: item;
  margin: 0 0 0 20px;
  padding: 0;
}
#menu-trace-list li {
  display: block;
  white-space: nowrap;
}

#menu-trace-list li .secnum:after {
  content: ' ';
}
#menu-trace-list li:before {
  content: counter(item) ' ';
  background-color: #222;
  counter-increment: item;
  color: #999;
  width: 20px;
  height: 20px;
  line-height: 20px;
  display: inline-block;
  text-align: center;
  margin: 2px 4px 2px 0;
}

@media (max-width: 1000px) {
  body {
    margin: 0;
    display: block;
  }

  #menu {
    display: none;
    padding-top: 3em;
    width: 450px;
  }

  #menu.active {
    position: fixed;
    height: 100%;
    left: 0;
    top: 0;
    right: 300px;
  }

  #menu-toggle {
    visibility: visible;
  }

  #spec-container {
    padding: 0 5px;
  }

  #references-pane-spacer {
    display: none;
  }
}

@media only screen and (max-width: 800px) {
  #menu {
    width: 100%;
  }

  h1 .secnum:empty {
    margin: 0;
    padding: 0;
  }
}

/* Toolbox */
.toolbox-container {
  position: absolute;
  display: none;
  padding-bottom: 7px;
}

.toolbox-container.active {
  display: inline-block;
}

.toolbox {
  position: relative;
  background: #ddd;
  border: 1px solid #aaa;
  color: #eee;
  padding: 5px;
  border-radius: 3px;
}

.toolbox a {
  text-decoration: none;
  padding: 0 5px;
}

.toolbox a:hover {
  text-decoration: underline;
}

.toolbox:after,
.toolbox:before {
  top: 100%;
  left: 15px;
  border: solid transparent;
  content: ' ';
  height: 0;
  width: 0;
  position: absolute;
  pointer-events: none;
}

.toolbox:after {
  border-color: rgba(0, 0, 0, 0);
  border-top-color: #ddd;
  border-width: 10px;
  margin-left: -10px;
}
.toolbox:before {
  border-color: rgba(204, 204, 204, 0);
  border-top-color: #aaa;
  border-width: 12px;
  margin-left: -12px;
}

#references-pane-container {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 250px;
  display: none;
  background-color: #ddd;
  z-index: 1;
}

#references-pane-table-container {
  overflow-x: hidden;
  overflow-y: auto;
}

#references-pane-spacer {
  flex-basis: 33%;
  max-width: 500px;
}

#references-pane {
  flex-grow: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

#references-pane-container.active {
  display: flex;
}

#references-pane-close:after {
  content: '✖';
  float: right;
  cursor: pointer;
}

#references-pane table tr td:first-child {
  text-align: right;
  padding-right: 5px;
}

@media print {
  #menu-toggle {
    display: none;
  }
}

[normative-optional],
[legacy] {
  border-left: 5px solid #ff6600;
  padding: 0.5em;
  display: block;
  background: #ffeedd;
}

.clause-attributes-tag {
  text-transform: uppercase;
  color: #884400;
}

.clause-attributes-tag a {
  color: #884400;
}

/* Shortcuts help dialog */

#shortcuts-help {
  position: fixed;
  left: 5%;
  margin: 0 auto;
  right: 5%;
  z-index: 10;
  top: 10%;
  top: calc(5vw + 5vh);
  padding: 30px 90px;
  max-width: 500px;
  outline: solid 10000px rgba(255, 255, 255, 0.6);
  border-radius: 5px;
  border-width: 1px 1px 0 1px;
  background-color: #ddd;
  display: none;
}

#shortcuts-help.active {
  display: block;
}

#shortcuts-help ul {
  padding: 0;
}

#shortcuts-help li {
  display: flex;
  justify-content: space-between;
}

#shortcuts-help code {
  padding: 3px 10px;
  border-radius: 3px;
  border-width: 1px 1px 0 1px;
  border-color: #bbb;
  background-color: #eee;
  box-shadow: inset 0 -1px 0 #ccc;
}
</style></head><body><div id="shortcuts-help">
<ul>
  <li><span>Toggle shortcuts help</span><code>?</code></li>
  <li><span>Toggle "can call user code" annotations</span><code>u</code></li>

  <li><span>Jump to search box</span><code>/</code></li>
</ul></div><div id="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%; stroke:currentColor" viewBox="0 0 120 120">
      <title>Menu</title>
      <path stroke-width="10" stroke-linecap="round" d="M30,60 h60  M30,30 m0,5 h60  M30,90 m0,-5 h60"></path>
    </svg></div><div id="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-well-known-intrinsic-objects" title="Well-Known Intrinsic Objects"><span class="secnum">1</span> Well-Known Intrinsic Objects</a></li><li><span class="item-toggle">◢</span><a href="#sec-abstract-operations" title="Abstract Operations"><span class="secnum">2</span> Abstract Operations</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-operations-on-iterator-objects" title="Operations on Iterator Objects"><span class="secnum">2.1</span> Operations on Iterator Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-getiteratordirect" title="GetIteratorDirect ( obj )"><span class="secnum">2.1.1</span> GetIteratorDirect ( <var>obj</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorstep" title="IteratorStep ( iteratorRecord [ , value ] )"><span class="secnum">2.1.2</span> IteratorStep ( <var>iteratorRecord</var> <ins>[ , <var>value</var> ]</ins> )</a></li></ol></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-control-abstraction-objects" title="Control Abstraction Objects"><span class="secnum">3</span> Control Abstraction Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-iteration" title="Iteration"><span class="secnum">3.1</span> Iteration</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-iterator-abstract-operations" title="Iterator Abstract Operations"><span class="secnum">3.1.1</span> Iterator Abstract Operations</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-ifabruptcloseasynciterator" title="IfAbruptCloseAsyncIterator ( value, iteratorRecord )"><span class="secnum">3.1.1.1</span> IfAbruptCloseAsyncIterator ( <var>value</var>, <var>iteratorRecord</var> )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-iterator-objects" title="Iterator Objects"><span class="secnum">3.1.2</span> Iterator Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-iterator-constructor" title="The Iterator Constructor"><span class="secnum">3.1.2.1</span> The Iterator Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-iterator" title="Iterator ( )"><span class="secnum">3.1.2.1.1</span> Iterator ( )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-properties-of-the-iterator-constructor" title="Properties of the Iterator Constructor"><span class="secnum">3.1.2.2</span> Properties of the Iterator Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-iterator.prototype" title="Iterator.prototype"><span class="secnum">3.1.2.2.1</span> Iterator.prototype</a></li><li><span class="item-toggle">◢</span><a href="#sec-iterator.from" title="Iterator.from ( O )"><span class="secnum">3.1.2.2.2</span> Iterator.from ( <var>O</var> )</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-wrapforvaliditeratorprototype-object" title="The %WrapForValidIteratorPrototype% Object"><span class="secnum">3.1.2.2.2.1</span> The %WrapForValidIteratorPrototype% Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-wrapforvaliditeratorprototype.next" title="%WrapForValidIteratorPrototype%.next ( value )"><span class="secnum">3.1.2.2.2.1.1</span> %WrapForValidIteratorPrototype%.next ( <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-wrapforvaliditeratorprototype.return" title="%WrapForValidIteratorPrototype%.return ( v )"><span class="secnum">3.1.2.2.2.1.2</span> %WrapForValidIteratorPrototype%.return ( <var>v</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-wrapforvaliditeratorprototype.throw" title="%WrapForValidIteratorPrototype%.throw ( v )"><span class="secnum">3.1.2.2.2.1.3</span> %WrapForValidIteratorPrototype%.throw ( <var>v</var> )</a></li></ol></li></ol></li></ol></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-asynciterator-objects" title="AsyncIterator Objects"><span class="secnum">3.1.3</span> AsyncIterator Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-asynciterator-constructor" title="The AsyncIterator Constructor"><span class="secnum">3.1.3.1</span> The AsyncIterator Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-asynciterator" title="AsyncIterator ( )"><span class="secnum">3.1.3.1.1</span> AsyncIterator ( )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-properties-of-the-asynciterator-constructor" title="Properties of the AsyncIterator Constructor"><span class="secnum">3.1.3.2</span> Properties of the AsyncIterator Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-asynciterator.prototype" title="AsyncIterator.prototype"><span class="secnum">3.1.3.2.1</span> AsyncIterator.prototype</a></li><li><span class="item-toggle">◢</span><a href="#sec-asynciterator.from" title="AsyncIterator.from ( O )"><span class="secnum">3.1.3.2.2</span> AsyncIterator.from ( <var>O</var> )</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-wrapforvalidasynciteratorprototype-object" title="The %WrapForValidAsyncIteratorPrototype% Object"><span class="secnum">3.1.3.2.2.1</span> The %WrapForValidAsyncIteratorPrototype% Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-wrapforvalidasynciteratorprototype.next" title="%WrapForValidAsyncIteratorPrototype%.next ( value )"><span class="secnum">3.1.3.2.2.1.1</span> %WrapForValidAsyncIteratorPrototype%.next ( <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-wrapforvalidasynciteratorprototype.return" title="%WrapForValidAsyncIteratorPrototype%.return ( v )"><span class="secnum">3.1.3.2.2.1.2</span> %WrapForValidAsyncIteratorPrototype%.return ( <var>v</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-wrapforvalidasynciteratorprototype.throw" title="%WrapForValidAsyncIteratorPrototype%.throw ( v )"><span class="secnum">3.1.3.2.2.1.3</span> %WrapForValidAsyncIteratorPrototype%.throw ( <var>v</var> )</a></li></ol></li></ol></li></ol></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-iterator-helper-objects" title="Iterator Helper Objects"><span class="secnum">3.1.4</span> Iterator Helper Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-%iteratorhelperprototype%-object" title="The %IteratorHelperPrototype% Object"><span class="secnum">3.1.4.1</span> The %IteratorHelperPrototype% Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-%iteratorhelperprototype%.next" title="%IteratorHelperPrototype%.next ( value )"><span class="secnum">3.1.4.1.1</span> %IteratorHelperPrototype%.next ( <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-%iteratorhelperprototype%.return" title="%IteratorHelperPrototype%.return ( value )"><span class="secnum">3.1.4.1.2</span> %IteratorHelperPrototype%.return ( <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-%iteratorhelperprototype%.throw" title="%IteratorHelperPrototype%.throw ( exception )"><span class="secnum">3.1.4.1.3</span> %IteratorHelperPrototype%.throw ( <var>exception</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-%iteratorhelperprototype%-@@tostringtag" title="%IteratorHelperPrototype% [ @@toStringTag ]"><span class="secnum">3.1.4.1.4</span> %IteratorHelperPrototype% [ @@toStringTag ]</a></li></ol></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-async-iterator-helper-objects" title="Async Iterator Helper Objects"><span class="secnum">3.1.5</span> Async Iterator Helper Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-%asynciteratorhelperprototype%-object" title="The %AsyncIteratorHelperPrototype% Object"><span class="secnum">3.1.5.1</span> The %AsyncIteratorHelperPrototype% Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-%asynciteratorhelperprototype%.next" title="%AsyncIteratorHelperPrototype%.next ( value )"><span class="secnum">3.1.5.1.1</span> %AsyncIteratorHelperPrototype%.next ( <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-%asynciteratorhelperprototype%.return" title="%AsyncIteratorHelperPrototype%.return ( value )"><span class="secnum">3.1.5.1.2</span> %AsyncIteratorHelperPrototype%.return ( <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-%asynciteratorhelperprototype%.throw" title="%AsyncIteratorHelperPrototype%.throw ( exception )"><span class="secnum">3.1.5.1.3</span> %AsyncIteratorHelperPrototype%.throw ( <var>exception</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-%asynciteratorhelperprototype%-@@tostringtag" title="%AsyncIteratorHelperPrototype% [ @@toStringTag ]"><span class="secnum">3.1.5.1.4</span> %AsyncIteratorHelperPrototype% [ @@toStringTag ]</a></li></ol></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-%iteratorprototype%-object" title="The %Iterator.prototype% Object"><span class="secnum">3.1.6</span> The <dfn>%Iterator.prototype%</dfn> Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.constructor" title="%Iterator.prototype%.constructor"><span class="secnum">3.1.6.1</span> %Iterator.prototype%.constructor</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.map" title="%Iterator.prototype%.map ( mapper )"><span class="secnum">3.1.6.2</span> %Iterator.prototype%.map ( <var>mapper</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.filter" title="%Iterator.prototype%.filter ( filterer )"><span class="secnum">3.1.6.3</span> %Iterator.prototype%.filter ( <var>filterer</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.take" title="%Iterator.prototype%.take ( limit )"><span class="secnum">3.1.6.4</span> %Iterator.prototype%.take ( <var>limit</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.drop" title="%Iterator.prototype%.drop ( limit )"><span class="secnum">3.1.6.5</span> %Iterator.prototype%.drop ( <var>limit</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.asindexedpairs" title="%Iterator.prototype%.asIndexedPairs ( )"><span class="secnum">3.1.6.6</span> %Iterator.prototype%.asIndexedPairs ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.flatmap" title="%Iterator.prototype%.flatMap ( mapper )"><span class="secnum">3.1.6.7</span> %Iterator.prototype%.flatMap ( <var>mapper</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.reduce" title="%Iterator.prototype%.reduce ( reducer [ , initialValue ] )"><span class="secnum">3.1.6.8</span> %Iterator.prototype%.reduce ( <var>reducer</var> [ , <var>initialValue</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.toarray" title="%Iterator.prototype%.toArray ( )"><span class="secnum">3.1.6.9</span> %Iterator.prototype%.toArray ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.foreach" title="%Iterator.prototype%.forEach ( fn )"><span class="secnum">3.1.6.10</span> %Iterator.prototype%.forEach ( <var>fn</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.some" title="%Iterator.prototype%.some ( fn )"><span class="secnum">3.1.6.11</span> %Iterator.prototype%.some ( <var>fn</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.every" title="%Iterator.prototype%.every ( fn )"><span class="secnum">3.1.6.12</span> %Iterator.prototype%.every ( <var>fn</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype.find" title="%Iterator.prototype%.find ( fn )"><span class="secnum">3.1.6.13</span> %Iterator.prototype%.find ( <var>fn</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-iteratorprototype-@@tostringtag" title="%Iterator.prototype% [ @@toStringTag ]"><span class="secnum">3.1.6.14</span> %Iterator.prototype% [ @@toStringTag ]</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-asynciteratorprototype" title="The %AsyncIterator.prototype% Object"><span class="secnum">3.1.7</span> The <dfn>%AsyncIterator.prototype%</dfn> Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.constructor" title="%AsyncIterator.prototype%.constructor"><span class="secnum">3.1.7.1</span> %AsyncIterator.prototype%.constructor</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.map" title="%AsyncIterator.prototype%.map ( mapper )"><span class="secnum">3.1.7.2</span> %AsyncIterator.prototype%.map ( <var>mapper</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.filter" title="%AsyncIterator.prototype%.filter ( filterer )"><span class="secnum">3.1.7.3</span> %AsyncIterator.prototype%.filter ( <var>filterer</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.take" title="%AsyncIterator.prototype%.take ( limit )"><span class="secnum">3.1.7.4</span> %AsyncIterator.prototype%.take ( <var>limit</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.drop" title="%AsyncIterator.prototype%.drop ( limit )"><span class="secnum">3.1.7.5</span> %AsyncIterator.prototype%.drop ( <var>limit</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.asindexedpairs" title="%AsyncIterator.prototype%.asIndexedPairs ( )"><span class="secnum">3.1.7.6</span> %AsyncIterator.prototype%.asIndexedPairs ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.flatmap" title="%AsyncIterator.prototype%.flatMap ( mapper )"><span class="secnum">3.1.7.7</span> %AsyncIterator.prototype%.flatMap ( <var>mapper</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.reduce" title="%AsyncIterator.prototype%.reduce ( reducer [ , initialValue ] )"><span class="secnum">3.1.7.8</span> %AsyncIterator.prototype%.reduce ( <var>reducer</var> [ , <var>initialValue</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.toarray" title="%AsyncIterator.prototype%.toArray ( )"><span class="secnum">3.1.7.9</span> %AsyncIterator.prototype%.toArray ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.foreach" title="%AsyncIterator.prototype%.forEach ( fn )"><span class="secnum">3.1.7.10</span> %AsyncIterator.prototype%.forEach ( <var>fn</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.some" title="%AsyncIterator.prototype%.some ( fn )"><span class="secnum">3.1.7.11</span> %AsyncIterator.prototype%.some ( <var>fn</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.every" title="%AsyncIterator.prototype%.every ( fn )"><span class="secnum">3.1.7.12</span> %AsyncIterator.prototype%.every ( <var>fn</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype.find" title="%AsyncIterator.prototype%.find ( fn )"><span class="secnum">3.1.7.13</span> %AsyncIterator.prototype%.find ( <var>fn</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-asynciteratorprototype-@@tostringtag" title="%AsyncIterator.prototype% [ @@toStringTag ]"><span class="secnum">3.1.7.14</span> %AsyncIterator.prototype% [ @@toStringTag ]</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-%asyncfromsynciteratorprototype%-object" title="The %AsyncFromSyncIteratorPrototype% Object"><span class="secnum">3.1.8</span> The %AsyncFromSyncIteratorPrototype% Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-%asyncfromsynciteratorprototype%.next" title="%AsyncFromSyncIteratorPrototype%.next ( value )"><span class="secnum">3.1.8.1</span> %AsyncFromSyncIteratorPrototype%.next ( <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-%asyncfromsynciteratorprototype%.return" title="%AsyncFromSyncIteratorPrototype%.return ( value )"><span class="secnum">3.1.8.2</span> %AsyncFromSyncIteratorPrototype%.return ( <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-%asyncfromsynciteratorprototype%.throw" title="%AsyncFromSyncIteratorPrototype%.throw ( value )"><span class="secnum">3.1.8.3</span> %AsyncFromSyncIteratorPrototype%.throw ( <var>value</var> )</a></li></ol></li></ol></li></ol></li></ol></div></div><div id="spec-container"><h1 class="version">Stage 2 Draft / July 5, 2022</h1><h1 class="title">Iterator Helpers</h1>
<script src="ecmarkup.js" defer=""></script>
<link rel="stylesheet" href="ecmarkup.css">
<style>
  ins.block {
    font-weight: bold;
    font-style: italic;
  }
  hr {
    height: 0.25em;
    background: #ccc;
    border: 0;
    margin: 2em 0;
  }
  .unicode-property-table {
    table-layout: fixed;
    width: 100%;
    font-size: 80%;
  }
  .unicode-property-table ul {
    padding-left: 0;
    list-style: none;
  }
  #metadata-block {
    margin: 4em 0;
    padding: 10px;
    border: 1px solid #ee8421;
  }
  #metadata-block h1 {
    font-size: 1.5em;
    margin-top: 0;
  }
  #metadata-block > ul {
    list-style-type: none;
    margin: 0; padding: 0;
  }
</style>

<div id="metadata-block">
  <h1>Contributing to this Proposal</h1>
  <p>This proposal is developed on GitHub with the help of the ECMAScript community. There are a number of ways to contribute to the development of this specification:</p>
  <ul>
    <li>GitHub Repository: <a href="https://github.com/tc39/proposal-iterator-helpers">https://github.com/tc39/proposal-iterator-helpers</a></li>
    <li>Issues: <a href="https://github.com/tc39/proposal-iterator-helpers/issues">All Issues</a>, <a href="https://github.com/tc39/proposal-iterator-helpers/issues/new">File a New Issue</a></li>
    <li>Pull Requests: <a href="https://github.com/tc39/proposal-iterator-helpers/pulls">All Pull Requests</a>, <a href="https://github.com/tc39/proposal-iterator-helpers/pulls/new">Create a New Pull Request</a></li>
    <!-- <li>Test Suite: <a href="https://github.com/tc39/test262">Test262</a></li> -->
    <li>
      <p>Community:</p>
      <ul>
        <li>Discourse: <a href="https://es.discourse.group">https://es.discourse.group</a></li>
        <li>IRC: <a href="ircs://irc.freenode.net:6667">#tc39</a> on <a href="https://freenode.net/kb/answer/chat">freenode</a></li>
      </ul>
    </li>
  </ul>
</div>

<emu-clause id="sec-well-known-intrinsic-objects">
  <h1><span class="secnum">1</span> Well-Known Intrinsic Objects</h1>

  <emu-table id="table-7" caption="Well-Known Intrinsic Objects"><figure><figcaption>Table 1: Well-Known Intrinsic Objects</figcaption>
    <table>
      <tbody><tr>
        <th>
          Intrinsic Name
        </th>
        <th>
          Global Name
        </th>
        <th>
          ECMAScript Language Association
        </th>
      </tr>
      <tr>
        <td>
          <ins><emu-xref href="#sec-asynciterator-constructor" id="_ref_2"><a href="#sec-asynciterator-constructor">%AsyncIterator%</a></emu-xref></ins>
        </td>
        <td>
          <ins><code>AsyncIterator</code></ins>
        </td>
        <td>
          <ins>The <code>AsyncIterator</code> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> (<emu-xref href="#sec-asynciterator-constructor" id="_ref_0"><a href="#sec-asynciterator-constructor">3.1.3.1</a></emu-xref>)</ins>
        </td>
      </tr>
      <tr>
        <td>
          <emu-xref href="#sec-asynciteratorprototype" id="_ref_3"><a href="#sec-asynciteratorprototype">%AsyncIteratorPrototype%</a></emu-xref>
        </td>
        <td>
          <ins><code>AsyncIterator.prototype</code></ins>
        </td>
        <td>
          An object that all standard built-in async iterator objects indirectly inherit from <p><ins>The initial value of the <emu-val>"prototype"</emu-val> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref> of <emu-xref href="#sec-asynciterator-constructor" id="_ref_4"><a href="#sec-asynciterator-constructor">%AsyncIterator%</a></emu-xref>; i.e., <emu-xref href="#sec-asynciteratorprototype" id="_ref_5"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref></ins></p>
        </td>
      </tr>
      <tr>
        <td>
          <ins><emu-xref href="#sec-iterator-constructor" id="_ref_6"><a href="#sec-iterator-constructor">%Iterator%</a></emu-xref></ins>
        </td>
        <td>
          <ins><code>Iterator</code></ins>
        </td>
        <td>
          <ins>The <code>Iterator</code> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> (<emu-xref href="#sec-iterator-constructor" id="_ref_1"><a href="#sec-iterator-constructor">3.1.2.1</a></emu-xref>)</ins>
        </td>
      </tr>
      <tr>
        <td>
          <emu-xref href="#sec-%iteratorprototype%-object" id="_ref_7"><a href="#sec-%iteratorprototype%-object">%IteratorPrototype%</a></emu-xref>
        </td>
        <td>
          <ins><code>Iterator.prototype</code></ins>
        </td>
        <td>
          An object that all standard built-in iterator objects indirectly inherit from <p><ins>The initial value of the <emu-val>"prototype"</emu-val> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref> of <emu-xref href="#sec-iterator-constructor" id="_ref_8"><a href="#sec-iterator-constructor">%Iterator%</a></emu-xref>; i.e., <emu-xref href="#sec-%iteratorprototype%-object" id="_ref_9"><a href="#sec-%iteratorprototype%-object">%Iterator.prototype%</a></emu-xref></ins></p>
        </td>
      </tr>
    </tbody></table>
  </figure></emu-table>
</emu-clause>

<emu-clause id="sec-abstract-operations">
  <h1><span class="secnum">2</span> Abstract Operations</h1>

  <emu-clause id="sec-operations-on-iterator-objects">
    <h1><span class="secnum">2.1</span> Operations on Iterator Objects</h1>

    <emu-clause id="sec-getiteratordirect" aoid="GetIteratorDirect">
      <h1><span class="secnum">2.1.1</span> GetIteratorDirect ( <var>obj</var> )</h1>
      <emu-alg><ol><li>If <emu-xref aoid="Type"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>obj</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>nextMethod</var> be ?&nbsp;<emu-xref aoid="GetV"><a href="https://tc39.es/ecma262/#sec-getv">GetV</a></emu-xref>(<var>obj</var>, <code>"next"</code>).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>nextMethod</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>iteratorRecord</var> be <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { [[Iterator]]: <var>obj</var>, [[NextMethod]]: <var>nextMethod</var>, [[Done]]: <emu-val>false</emu-val> }.</li><li>Return <var>iteratorRecord</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-iteratorstep" aoid="IteratorStep">
      <h1><span class="secnum">2.1.2</span> IteratorStep ( <var>iteratorRecord</var> <ins>[ , <var>value</var> ]</ins> )</h1>

      <emu-alg><ol><li><del>Let <var>result</var> be ?&nbsp;<emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iteratorRecord</var>).</del></li><li><ins>If <var>value</var> is present, then</ins><ol><li><ins>Let <var>result</var> be ?&nbsp;<emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iteratorRecord</var>, <var>value</var>).</ins></li></ol></li><li><ins>Else,</ins><ol><li><ins>Let <var>result</var> be ?&nbsp;<emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iteratorRecord</var>).</ins></li></ol></li><li>Let <var>done</var> be ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>result</var>).</li><li>If <var>done</var> is <emu-val>true</emu-val>, return <emu-val>false</emu-val>.</li><li>Return <var>result</var>.</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>
</emu-clause>

<emu-clause id="sec-control-abstraction-objects">
  <h1><span class="secnum">3</span> Control Abstraction Objects</h1>

  <emu-clause id="sec-iteration">
    <h1><span class="secnum">3.1</span> Iteration</h1>

    <emu-clause id="sec-iterator-abstract-operations">
      <h1><span class="secnum">3.1.1</span> Iterator Abstract Operations</h1>

      <emu-clause id="sec-ifabruptcloseasynciterator" aoid="IfAbruptCloseAsyncIterator">
        <h1><span class="secnum">3.1.1.1</span> IfAbruptCloseAsyncIterator ( <var>value</var>, <var>iteratorRecord</var> )</h1>
        <p>IfAbruptCloseAsyncIterator is a shorthand for a sequence of algorithm steps that use an <emu-xref href="#sec-iterator-records"><a href="https://tc39.es/ecma262/#sec-iterator-records">Iterator Record</a></emu-xref>. An algorithm step of the form:</p>
        <emu-alg><ol><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_10"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>value</var>, <var>iteratorRecord</var>).</li></ol></emu-alg>
        <p>means the same thing as:</p>
        <emu-alg><ol><li>If <var>value</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>iteratorRecord</var>, <var>value</var>).</li><li>Return <var>value</var>.</li></ol></li><li>Else if <var>value</var> is a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">Completion Record</a></emu-xref>, set <var>value</var> to <var>value</var>.[[Value]].</li></ol></emu-alg>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-iterator-objects">
      <h1><span class="secnum">3.1.2</span> Iterator Objects</h1>

      <emu-clause id="sec-iterator-constructor">
        <h1><span class="secnum">3.1.2.1</span> The Iterator Constructor</h1>
        <p>The <dfn>Iterator</dfn> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
        <ul>
          <li>is <dfn>%Iterator%</dfn>.</li>
          <li>is the initial value of the <emu-val>Iterator</emu-val> property of the <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.</li>
          <li>is designed to be subclassable. It may be used as the value of an <emu-val>extends</emu-val> clause of a class definition.</li>
        </ul>

        <emu-clause id="sec-iterator">
          <h1><span class="secnum">3.1.2.1.1</span> Iterator ( )</h1>
          <p>When the <code>Iterator</code> function is called, the following steps are taken:</p>
          <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val> or the <emu-xref href="#active-function-object"><a href="https://tc39.es/ecma262/#active-function-object">active function object</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Return ?&nbsp;<emu-xref aoid="OrdinaryCreateFromConstructor"><a href="https://tc39.es/ecma262/#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a></emu-xref>(NewTarget, <emu-val>"%Iterator.prototype%"</emu-val>).</li></ol></emu-alg>
        </emu-clause>
      </emu-clause>

      <emu-clause id="sec-properties-of-the-iterator-constructor">
        <h1><span class="secnum">3.1.2.2</span> Properties of the Iterator Constructor</h1>
        <emu-clause id="sec-iterator.prototype">
          <h1><span class="secnum">3.1.2.2.1</span> Iterator.prototype</h1>
          <p>The initial value of Iterator.prototype is <emu-xref href="#sec-%iteratorprototype%-object" id="_ref_11"><a href="#sec-%iteratorprototype%-object">%Iterator.prototype%</a></emu-xref>.</p>
          <p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val> }.</p>
        </emu-clause>

        <emu-clause id="sec-iterator.from">
          <h1><span class="secnum">3.1.2.2.2</span> Iterator.from ( <var>O</var> )</h1>
          <emu-alg><ol><li>Let <var>usingIterator</var> be ?&nbsp;<emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>O</var>, <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@iterator</a></emu-xref>).</li><li>If <var>usingIterator</var> is not <emu-val>undefined</emu-val>,<ol><li>Let <var>iteratorRecord</var> be ?&nbsp;<emu-xref aoid="GetIterator"><a href="https://tc39.es/ecma262/#sec-getiterator">GetIterator</a></emu-xref>(<var>O</var>, <emu-const>sync</emu-const>, <var>usingIterator</var>).</li><li>Let <var>hasInstance</var> be ?&nbsp;<emu-xref aoid="OrdinaryHasInstance"><a href="https://tc39.es/ecma262/#sec-ordinaryhasinstance">OrdinaryHasInstance</a></emu-xref>(<emu-xref href="#sec-iterator-constructor" id="_ref_12"><a href="#sec-iterator-constructor">%Iterator%</a></emu-xref>, <var>iteratorRecord</var>.[[Iterator]]).</li><li>If <var>hasInstance</var> is <emu-val>true</emu-val>, then<ol><li>Return <var>iteratorRecord</var>.[[Iterator]].</li></ol></li></ol></li><li>Else, Let <var>iteratorRecord</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_13"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<var>O</var>).</li><li>Let <var>wrapper</var> be !&nbsp;ObjectCreate(<emu-xref href="#sec-wrapforvaliditeratorprototype-object" id="_ref_14"><a href="#sec-wrapforvaliditeratorprototype-object">%WrapForValidIteratorPrototype%</a></emu-xref>, « [[Iterated]] »).</li><li>Set <var>wrapper</var>.[[Iterated]] to <var>iteratorRecord</var>.</li><li>Return <var>wrapper</var>.</li></ol></emu-alg>

          <emu-clause id="sec-wrapforvaliditeratorprototype-object">
            <h1><span class="secnum">3.1.2.2.2.1</span> The %WrapForValidIteratorPrototype% Object</h1>
            <p>The <dfn>%WrapForValidIteratorPrototype%</dfn> object:</p>
            <ul>
              <li>has a [[Prototype]] internal slot whose value is <emu-xref href="#sec-%iteratorprototype%-object" id="_ref_15"><a href="#sec-%iteratorprototype%-object">%Iterator.prototype%</a></emu-xref>.</li>
            </ul>

            <emu-clause id="sec-wrapforvaliditeratorprototype.next">
              <h1><span class="secnum">3.1.2.2.2.1.1</span> %WrapForValidIteratorPrototype%.next ( <var>value</var> )</h1>
              <emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li><emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[Iterated]]).</li><li>If <var>value</var> is not present, then<ol><li>Return ?&nbsp;<emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>O</var>.[[Iterated]]).</li></ol></li><li>Else,<ol><li>Return ?&nbsp;<emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>O</var>.[[Iterated]], <var>value</var>).</li></ol></li></ol></emu-alg>
            </emu-clause>

            <emu-clause id="sec-wrapforvaliditeratorprototype.return">
              <h1><span class="secnum">3.1.2.2.2.1.2</span> %WrapForValidIteratorPrototype%.return ( <var>v</var> )</h1>
              <emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li><emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[Iterated]]).</li><li>Let <var>result</var> be ?&nbsp;<emu-xref aoid="IteratorClose"><a href="https://tc39.es/ecma262/#sec-iteratorclose">IteratorClose</a></emu-xref>(<var>O</var>.[[Iterated]], <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<var>v</var>)).</li><li>Return <emu-xref aoid="CreateIterResultObject"><a href="https://tc39.es/ecma262/#sec-createiterresultobject">CreateIterResultObject</a></emu-xref>(<var>result</var>, true).</li></ol></emu-alg>
            </emu-clause>

            <emu-clause id="sec-wrapforvaliditeratorprototype.throw">
              <h1><span class="secnum">3.1.2.2.2.1.3</span> %WrapForValidIteratorPrototype%.throw ( <var>v</var> )</h1>
              <emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li><emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[Iterated]]).</li><li>Let <var>iterator</var> be <var>O</var>.[[Iterated]].[[Iterator]].</li><li>Let <var>throw</var> be ?&nbsp;<emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>iterator</var>, <emu-val>"throw"</emu-val>).</li><li>If <var>throw</var> is <emu-val>undefined</emu-val>, return <emu-xref aoid="ThrowCompletion"><a href="https://tc39.es/ecma262/#sec-throwcompletion">ThrowCompletion</a></emu-xref>(<var>v</var>).</li><li>Otherwise, return ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>throw</var>, <var>iterator</var>, « <var>v</var> »).</li></ol></emu-alg>
            </emu-clause>
          </emu-clause>
        </emu-clause>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-asynciterator-objects">
      <h1><span class="secnum">3.1.3</span> AsyncIterator Objects</h1>

      <emu-clause id="sec-asynciterator-constructor">
        <h1><span class="secnum">3.1.3.1</span> The AsyncIterator Constructor</h1>
        <p>The <dfn>AsyncIterator</dfn> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
        <ul>
          <li>is <dfn>%AsyncIterator%</dfn>.</li>
          <li>is the initial value of the <emu-val>AsyncIterator</emu-val> property of the <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.</li>
          <li>is designed to be subclassable. It may be used as the value of an <emu-val>extends</emu-val> clause of a class definition.</li>
        </ul>
        <emu-clause id="sec-asynciterator">
          <h1><span class="secnum">3.1.3.1.1</span> AsyncIterator ( )</h1>
          <p>When the <code>AsyncIterator</code> function is called, the following steps are taken:</p>
          <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val> or the <emu-xref href="#active-function-object"><a href="https://tc39.es/ecma262/#active-function-object">active function object</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Return ?&nbsp;<emu-xref aoid="OrdinaryCreateFromConstructor"><a href="https://tc39.es/ecma262/#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a></emu-xref>(NewTarget, <emu-val>"%AsyncIterator.prototype%"</emu-val>).</li></ol></emu-alg>
        </emu-clause>
      </emu-clause>

      <emu-clause id="sec-properties-of-the-asynciterator-constructor">
        <h1><span class="secnum">3.1.3.2</span> Properties of the AsyncIterator Constructor</h1>
        <emu-clause id="sec-asynciterator.prototype">
          <h1><span class="secnum">3.1.3.2.1</span> AsyncIterator.prototype</h1>
          <p>The initial value of AsyncIterator.prototype is <emu-xref href="#sec-asynciteratorprototype" id="_ref_16"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.</p>
          <p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>false</emu-val> }.</p>
        </emu-clause>

        <emu-clause id="sec-asynciterator.from">
          <h1><span class="secnum">3.1.3.2.2</span> AsyncIterator.from ( <var>O</var> )</h1>
          <emu-alg><ol><li>Let <var>usingIterator</var> be ?&nbsp;<emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>O</var>, <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@asyncIterator</a></emu-xref>).</li><li>If <var>usingIterator</var> is not <emu-val>undefined</emu-val>,<ol><li>Let <var>iteratorRecord</var> be ?&nbsp;<emu-xref aoid="GetIterator"><a href="https://tc39.es/ecma262/#sec-getiterator">GetIterator</a></emu-xref>(<var>O</var>, <emu-const>async</emu-const>, <var>usingIterator</var>).</li><li>Let <var>hasInstance</var> be ?&nbsp;<emu-xref aoid="OrdinaryHasInstance"><a href="https://tc39.es/ecma262/#sec-ordinaryhasinstance">OrdinaryHasInstance</a></emu-xref>(<emu-xref href="#sec-asynciteratorprototype" id="_ref_17"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>, <var>iteratorRecord</var>.[[Iterator]]).</li><li>If <var>hasInstance</var> is <emu-val>true</emu-val>, then<ol><li>Return <var>iteratorRecord</var>.[[Iterator]].</li></ol></li></ol></li><li>If <var>iteratorRecord</var> is <emu-val>undefined</emu-val>,<ol><li>Set <var>usingIterator</var> to ?&nbsp;<emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>O</var>, <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@iterator</a></emu-xref>).</li><li>If <var>usingIterator</var> is not <emu-val>undefined</emu-val>,<ol><li>Let <var>syncIteratorRecord</var> be ?&nbsp;<emu-xref aoid="GetIterator"><a href="https://tc39.es/ecma262/#sec-getiterator">GetIterator</a></emu-xref>(<var>O</var>, <emu-const>sync</emu-const>, <var>usingIterator</var>).</li><li>Return !&nbsp;<emu-xref aoid="CreateAsyncFromSyncIterator"><a href="https://tc39.es/ecma262/#sec-createasyncfromsynciterator">CreateAsyncFromSyncIterator</a></emu-xref>(<var>syncIteratorRecord</var>).</li></ol></li></ol></li><li>If <var>iteratorRecord</var> is <emu-val>undefined</emu-val>, set <var>iteratorRecord</var> to ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_18"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<var>O</var>).</li><li>Let <var>wrapper</var> be !&nbsp;ObjectCreate(<emu-xref href="#sec-wrapforvalidasynciteratorprototype-object" id="_ref_19"><a href="#sec-wrapforvalidasynciteratorprototype-object">%WrapForValidAsyncIteratorPrototype%</a></emu-xref>, « [[AsyncIterated]] »).</li><li>Set <var>wrapper</var>.[[AsyncIterated]] to <var>iteratorRecord</var>.</li><li>Return <var>wrapper</var>.</li></ol></emu-alg>

          <emu-clause id="sec-wrapforvalidasynciteratorprototype-object">
            <h1><span class="secnum">3.1.3.2.2.1</span> The %WrapForValidAsyncIteratorPrototype% Object</h1>
            <p>The <dfn>%WrapForValidAsyncIteratorPrototype%</dfn> object:</p>

            <ul>
              <li>is an <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref>.</li>
              <li>has a [[Prototype]] internal slot whose value is <emu-xref href="#sec-asynciteratorprototype" id="_ref_20"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.</li>
              <li>has the following properties:</li>
            </ul>

            <emu-clause id="sec-wrapforvalidasynciteratorprototype.next">
              <h1><span class="secnum">3.1.3.2.2.1.1</span> %WrapForValidAsyncIteratorPrototype%.next ( <var>value</var> )</h1>
              <emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>check</var> be <emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[AsyncIterated]]).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>check</var>, <var>promiseCapability</var>).</li><li>If <var>value</var> is not present, then<ol><li>Let <var>result</var> be <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>O</var>.[[AsyncIterated]]).</li></ol></li><li>Else,<ol><li>Let <var>result</var> be <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>O</var>.[[AsyncIterated]], <var>value</var>).</li></ol></li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, « <var>result</var> »).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></emu-alg>
            </emu-clause>

            <emu-clause id="sec-wrapforvalidasynciteratorprototype.return">
              <h1><span class="secnum">3.1.3.2.2.1.2</span> %WrapForValidAsyncIteratorPrototype%.return ( <var>v</var> )</h1>
              <emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>check</var> be <emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[AsyncIterated]]).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>check</var>, <var>promiseCapability</var>).</li><li>Let <var>result</var> be <emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>O</var>.[[AsyncIterated]], <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<var>v</var>)).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li><li>Let <var>iterResult</var> be !&nbsp;<emu-xref aoid="CreateIterResultObject"><a href="https://tc39.es/ecma262/#sec-createiterresultobject">CreateIterResultObject</a></emu-xref>(<var>result</var>, <emu-val>true</emu-val>).</li><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, « <var>iterResult</var> »).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></emu-alg>
            </emu-clause>

            <emu-clause id="sec-wrapforvalidasynciteratorprototype.throw">
              <h1><span class="secnum">3.1.3.2.2.1.3</span> %WrapForValidAsyncIteratorPrototype%.throw ( <var>v</var> )</h1>
              <emu-alg><ol><li>Let <var>O</var> be <emu-val>this</emu-val> value.</li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li>Let <var>check</var> be <emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[AsyncIterated]]).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>check</var>, <var>promiseCapability</var>).</li><li>Let <var>iterator</var> be <var>O</var>.[[AsyncIterated]].[[Iterator]].</li><li>Let <var>throw</var> be <emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>iterator</var>, <emu-val>"throw"</emu-val>).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>throw</var>, <var>promiseCapability</var>).</li><li>If <var>throw</var> is <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, « <var>v</var> »).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>throw</var>, <var>iterator</var>, « <var>v</var> »).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, « <var>result</var> »).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></emu-alg>
            </emu-clause>
          </emu-clause>
        </emu-clause>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-iterator-helper-objects">
      <h1><span class="secnum">3.1.4</span> Iterator Helper Objects</h1>
      <p>An <emu-xref href="#sec-iterator-constructor" id="_ref_21"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> Helper object is an <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref> that represents a lazy transformation of some specific source iterator object. There is not a named <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> for <emu-xref href="#sec-iterator-constructor" id="_ref_22"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> Helper objects. Instead, <emu-xref href="#sec-iterator-constructor" id="_ref_23"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> Helper objects are created by calling certain methods of <emu-xref href="#sec-iterator-constructor" id="_ref_24"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> instance objects.</p>

      <emu-clause id="sec-%iteratorhelperprototype%-object">
        <h1><span class="secnum">3.1.4.1</span> The %IteratorHelperPrototype% Object</h1>
        <p>The <dfn>%IteratorHelperPrototype%</dfn> object:</p>
        <ul>
          <li>has properties that are inherited by all <emu-xref href="#sec-iterator-constructor" id="_ref_25"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> Helper Objects.</li>
          <li>is an <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref>.</li>
          <li>has a [[Prototype]] internal slot whose value is <emu-xref href="#sec-%iteratorprototype%-object" id="_ref_26"><a href="#sec-%iteratorprototype%-object">%Iterator.prototype%</a></emu-xref>.</li>
          <li>has the following properties:</li>
        </ul>

        <emu-clause id="sec-%iteratorhelperprototype%.next">
          <h1><span class="secnum">3.1.4.1.1</span> %IteratorHelperPrototype%.next ( <var>value</var> )</h1>
          <emu-alg><ol><li>Return ?&nbsp;<emu-xref aoid="GeneratorResume"><a href="https://tc39.es/ecma262/#sec-generatorresume">GeneratorResume</a></emu-xref>(<emu-val>this</emu-val> value, <var>value</var>, <emu-const>Iterator Helper</emu-const>).</li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-%iteratorhelperprototype%.return">
          <h1><span class="secnum">3.1.4.1.2</span> %IteratorHelperPrototype%.return ( <var>value</var> )</h1>
          <emu-alg><ol><li>Let <var>C</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref> { [[Type]]: <emu-const>return</emu-const>, [[Value]]: <var>value</var>, [[Target]]: <emu-const>empty</emu-const> }.</li><li>Return ?&nbsp;<emu-xref aoid="GeneratorResumeAbrupt"><a href="https://tc39.es/ecma262/#sec-generatorresumeabrupt">GeneratorResumeAbrupt</a></emu-xref>(<emu-val>this</emu-val> value, <var>C</var>, <emu-const>Iterator Helper</emu-const>).</li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-%iteratorhelperprototype%.throw">
          <h1><span class="secnum">3.1.4.1.3</span> %IteratorHelperPrototype%.throw ( <var>exception</var> )</h1>
          <emu-alg><ol><li>Let <var>C</var> be <emu-xref aoid="ThrowCompletion"><a href="https://tc39.es/ecma262/#sec-throwcompletion">ThrowCompletion</a></emu-xref>(<var>exception</var>).</li><li>Return ?&nbsp;<emu-xref aoid="GeneratorResumeAbrupt"><a href="https://tc39.es/ecma262/#sec-generatorresumeabrupt">GeneratorResumeAbrupt</a></emu-xref>(<emu-val>this</emu-val> value, <var>C</var>, <emu-const>Iterator Helper</emu-const>).</li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-%iteratorhelperprototype%-@@tostringtag">
          <h1><span class="secnum">3.1.4.1.4</span> %IteratorHelperPrototype% [ @@toStringTag ]</h1>
          <p>The initial value of the <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@toStringTag</a></emu-xref> property is the String value <emu-val>"Iterator Helper"</emu-val>.</p>
          <p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>true</emu-val> }.</p>
        </emu-clause>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-async-iterator-helper-objects">
      <h1><span class="secnum">3.1.5</span> Async Iterator Helper Objects</h1>
      <p>An Async <emu-xref href="#sec-iterator-constructor" id="_ref_27"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> Helper object is an <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref> that represents a lazy transformation of some specific source async iterator object. There is not a named <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> for Async <emu-xref href="#sec-iterator-constructor" id="_ref_28"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> Helper objects. Instead, Async <emu-xref href="#sec-iterator-constructor" id="_ref_29"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> Helper objects are created by calling certain methods of <emu-xref href="#sec-asynciterator-constructor" id="_ref_30"><a href="#sec-asynciterator-constructor">AsyncIterator</a></emu-xref> instance objects.</p>

      <emu-clause id="sec-%asynciteratorhelperprototype%-object">
        <h1><span class="secnum">3.1.5.1</span> The %AsyncIteratorHelperPrototype% Object</h1>
        <p>The <dfn>%AsyncIteratorHelperPrototype%</dfn> object:</p>
        <ul>
          <li>has properties that are inherited by all Async <emu-xref href="#sec-iterator-constructor" id="_ref_31"><a href="#sec-iterator-constructor">Iterator</a></emu-xref> Helper Objects.</li>
          <li>is an <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref>.</li>
          <li>has a [[Prototype]] internal slot whose value is <emu-xref href="#sec-asynciteratorprototype" id="_ref_32"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.</li>
          <li>has the following properties:</li>
        </ul>

        <emu-clause id="sec-%asynciteratorhelperprototype%.next">
          <h1><span class="secnum">3.1.5.1.1</span> %AsyncIteratorHelperPrototype%.next ( <var>value</var> )</h1>
          <emu-alg><ol><li>Let <var>C</var> be <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<var>value</var>).</li><li>Return !&nbsp;<emu-xref aoid="AsyncGeneratorEnqueue"><a href="https://tc39.es/ecma262/#sec-asyncgeneratorenqueue">AsyncGeneratorEnqueue</a></emu-xref>(<emu-val>this</emu-val> value, <var>C</var>, <emu-const>Async Iterator Helper</emu-const>).</li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-%asynciteratorhelperprototype%.return">
          <h1><span class="secnum">3.1.5.1.2</span> %AsyncIteratorHelperPrototype%.return ( <var>value</var> )</h1>
          <emu-alg><ol><li>Let <var>C</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref> { [[Type]]: <emu-const>return</emu-const>, [[Value]]: <var>value</var>, [[Target]]: <emu-const>empty</emu-const> }.</li><li>Return !&nbsp;<emu-xref aoid="AsyncGeneratorEnqueue"><a href="https://tc39.es/ecma262/#sec-asyncgeneratorenqueue">AsyncGeneratorEnqueue</a></emu-xref>(<emu-val>this</emu-val> value, <var>C</var>, <emu-const>Async Iterator Helper</emu-const>).</li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-%asynciteratorhelperprototype%.throw">
          <h1><span class="secnum">3.1.5.1.3</span> %AsyncIteratorHelperPrototype%.throw ( <var>exception</var> )</h1>
          <emu-alg><ol><li>Let <var>C</var> be <emu-xref aoid="ThrowCompletion"><a href="https://tc39.es/ecma262/#sec-throwcompletion">ThrowCompletion</a></emu-xref>(<var>exception</var>).</li><li>Return !&nbsp;<emu-xref aoid="AsyncGeneratorEnqueue"><a href="https://tc39.es/ecma262/#sec-asyncgeneratorenqueue">AsyncGeneratorEnqueue</a></emu-xref>(<emu-val>this</emu-val> value, <var>C</var>, <emu-const>Async Iterator Helper</emu-const>).</li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-%asynciteratorhelperprototype%-@@tostringtag">
          <h1><span class="secnum">3.1.5.1.4</span> %AsyncIteratorHelperPrototype% [ @@toStringTag ]</h1>
          <p>The initial value of the <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@toStringTag</a></emu-xref> property is the String value <emu-val>"Async Iterator Helper"</emu-val>.</p>
          <p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>true</emu-val> }.</p>
        </emu-clause>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-%iteratorprototype%-object">
      <h1><span class="secnum">3.1.6</span> The <dfn>%Iterator.prototype%</dfn> Object</h1>

      <emu-clause id="sec-iteratorprototype.constructor">
        <h1><span class="secnum">3.1.6.1</span> %Iterator.prototype%.constructor</h1>
        <p>The initial value of <emu-xref href="#sec-%iteratorprototype%-object" id="_ref_33"><a href="#sec-%iteratorprototype%-object">%Iterator.prototype%</a></emu-xref>.<emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> is <emu-xref href="#sec-iterator-constructor" id="_ref_34"><a href="#sec-iterator-constructor">%Iterator%</a></emu-xref>.</p>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.map">
        <h1><span class="secnum">3.1.6.2</span> %Iterator.prototype%.map ( <var>mapper</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_35"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>mapper</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>mapper</var> and performs the following steps when called:<ol><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_36"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>mapped</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>mapper</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>iterated</var>, <var>mapped</var>).</li><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(<var>mapped</var>).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createiteratorfromclosure">CreateIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Iterator Helper</emu-const>, <emu-xref href="#sec-%iteratorhelperprototype%-object" id="_ref_37"><a href="#sec-%iteratorhelperprototype%-object">%IteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.filter">
        <h1><span class="secnum">3.1.6.3</span> %Iterator.prototype%.filter ( <var>filterer</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_38"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>filterer</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>filterer</var> and performs the following steps when called:<ol><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_39"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>selected</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>filterer</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>iterated</var>, <var>selected</var>).</li><li>If !&nbsp;<emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(<var>selected</var>) is <emu-val>true</emu-val>,<ol><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(<var>value</var>).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createiteratorfromclosure">CreateIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Iterator Helper</emu-const>, <emu-xref href="#sec-%iteratorhelperprototype%-object" id="_ref_40"><a href="#sec-%iteratorhelperprototype%-object">%IteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.take">
        <h1><span class="secnum">3.1.6.4</span> %Iterator.prototype%.take ( <var>limit</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_41"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>integerLimit</var> be ?&nbsp;<emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity">ToIntegerOrInfinity</a></emu-xref>(<var>limit</var>).</li><li>If <var>integerLimit</var> &lt; 0, throw a <emu-val>RangeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>integerLimit</var> and performs the following steps when called:<ol><li>Let <var>remaining</var> be <var>integerLimit</var>.</li><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>If <var>remaining</var> is 0, then<ol><li>Return ?&nbsp;<emu-xref aoid="IteratorClose"><a href="https://tc39.es/ecma262/#sec-iteratorclose">IteratorClose</a></emu-xref>(<var>iterated</var>, <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>undefined</emu-val>)).</li></ol></li><li>If <var>remaining</var> is not +∞, then<ol><li>Set <var>remaining</var> to <var>remaining</var> - 1.</li></ol></li><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_42"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(? <emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>)).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createiteratorfromclosure">CreateIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Iterator Helper</emu-const>, <emu-xref href="#sec-%iteratorhelperprototype%-object" id="_ref_43"><a href="#sec-%iteratorhelperprototype%-object">%IteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.drop">
        <h1><span class="secnum">3.1.6.5</span> %Iterator.prototype%.drop ( <var>limit</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_44"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>integerLimit</var> be ?&nbsp;<emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity">ToIntegerOrInfinity</a></emu-xref>(<var>limit</var>).</li><li>If <var>integerLimit</var> &lt; 0, throw a <emu-val>RangeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>integerLimit</var> and performs the following steps when called:<ol><li>Let <var>remaining</var> be <var>integerLimit</var>.</li><li>Repeat, while <var>remaining</var> &gt; 0,<ol><li>If <var>remaining</var> is not +∞, then<ol><li>Set <var>remaining</var> to <var>remaining</var> - 1.</li></ol></li><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_45"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li></ol></li><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_46"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(? <emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>)).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createiteratorfromclosure">CreateIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Iterator Helper</emu-const>, <emu-xref href="#sec-%iteratorhelperprototype%-object" id="_ref_47"><a href="#sec-%iteratorhelperprototype%-object">%IteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.asindexedpairs">
        <h1><span class="secnum">3.1.6.6</span> %Iterator.prototype%.asIndexedPairs ( )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_48"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and performs the following steps when called:<ol><li>Let <var>index</var> be 0.</li><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_49"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>pair</var> be !&nbsp;<emu-xref aoid="CreateArrayFromList"><a href="https://tc39.es/ecma262/#sec-createarrayfromlist">CreateArrayFromList</a></emu-xref>(« <var>index</var>, <var>value</var> »).</li><li>Set <var>index</var> to <var>index</var> + 1.</li><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(<var>pair</var>).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createiteratorfromclosure">CreateIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Iterator Helper</emu-const>, <emu-xref href="#sec-%iteratorhelperprototype%-object" id="_ref_50"><a href="#sec-%iteratorhelperprototype%-object">%IteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.flatmap">
        <h1><span class="secnum">3.1.6.7</span> %Iterator.prototype%.flatMap ( <var>mapper</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_51"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>mapper</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>mapper</var> and performs the following steps when called:<ol><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_52"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>mapped</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>mapper</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>mapped</var>, <var>iterated</var>).</li><li>Let <var>innerIterator</var> be <emu-xref aoid="GetIterator"><a href="https://tc39.es/ecma262/#sec-getiterator">GetIterator</a></emu-xref>(<var>mapped</var>, <emu-const>sync</emu-const>).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>innerIterator</var>, <var>iterated</var>).</li><li>Let <var>innerAlive</var> be <emu-val>true</emu-val>.</li><li>Repeat, while <var>innerAlive</var> is <emu-val>true</emu-val>,<ol><li>Let <var>innerNext</var> be <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>innerIterator</var>).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>innerNext</var>, <var>iterated</var>).</li><li>Let <var>innerComplete</var> be <emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>innerNext</var>).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>innerComplete</var>, <var>iterated</var>).</li><li>If <var>innerComplete</var> is <emu-val>true</emu-val>, set <var>innerAlive</var> to <emu-val>false</emu-val>.</li><li>Else,<ol><li>Let <var>innerValue</var> be <emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>innerNext</var>).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>innerValue</var>, <var>iterated</var>).</li><li>Let <var>yielded</var> be <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(<var>innerValue</var>).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>yielded</var>, <var>iterated</var>).</li></ol></li></ol></li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createiteratorfromclosure">CreateIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Iterator Helper</emu-const>, <emu-xref href="#sec-%iteratorhelperprototype%-object" id="_ref_53"><a href="#sec-%iteratorhelperprototype%-object">%IteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.reduce">
        <h1><span class="secnum">3.1.6.8</span> %Iterator.prototype%.reduce ( <var>reducer</var> [ , <var>initialValue</var> ] )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_54"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>reducer</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>initialValue</var> is not present, then<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_55"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>accumulator</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li></ol></li><li>Else,<ol><li>Let <var>accumulator</var> be <var>initialValue</var>.</li></ol></li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_56"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <var>accumulator</var>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>reducer</var>, <emu-val>undefined</emu-val>, « <var>accumulator</var>, <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>result</var>, <var>iterated</var>).</li><li>Set <var>accumulator</var> to <var>result</var>.[[Value]].</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.toarray">
        <h1><span class="secnum">3.1.6.9</span> %Iterator.prototype%.toArray ( )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_57"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>items</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_58"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return !&nbsp;<emu-xref aoid="CreateArrayFromList"><a href="https://tc39.es/ecma262/#sec-createarrayfromlist">CreateArrayFromList</a></emu-xref>(<var>items</var>).</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Append <var>value</var> to <var>items</var>.</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.foreach">
        <h1><span class="secnum">3.1.6.10</span> %Iterator.prototype%.forEach ( <var>fn</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_59"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>fn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_60"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>fn</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>result</var>, <var>iterated</var>).</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.some">
        <h1><span class="secnum">3.1.6.11</span> %Iterator.prototype%.some ( <var>fn</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_61"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>fn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_62"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>false</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>fn</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>result</var>, <var>iterated</var>).</li><li>If !&nbsp;<emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(<var>result</var>) is <emu-val>true</emu-val>, return ?&nbsp;<emu-xref aoid="IteratorClose"><a href="https://tc39.es/ecma262/#sec-iteratorclose">IteratorClose</a></emu-xref>(<var>iterated</var>, <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>true</emu-val>)).</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.every">
        <h1><span class="secnum">3.1.6.12</span> %Iterator.prototype%.every ( <var>fn</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_63"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>fn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_64"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>true</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>fn</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>result</var>, <var>iterated</var>).</li><li>If !&nbsp;<emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(<var>result</var>) is <emu-val>false</emu-val>, return ?&nbsp;<emu-xref aoid="IteratorClose"><a href="https://tc39.es/ecma262/#sec-iteratorclose">IteratorClose</a></emu-xref>(<var>iterated</var>, <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>false</emu-val>)).</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype.find">
        <h1><span class="secnum">3.1.6.13</span> %Iterator.prototype%.find ( <var>fn</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_65"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>fn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="IteratorStep" id="_ref_66"><a href="#sec-iteratorstep">IteratorStep</a></emu-xref>(<var>iterated</var>).</li><li>If <var>next</var> is <emu-val>false</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>fn</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseIterator"><a href="https://tc39.es/ecma262/#sec-ifabruptcloseiterator">IfAbruptCloseIterator</a></emu-xref>(<var>result</var>, <var>iterated</var>).</li><li>If !&nbsp;<emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(<var>result</var>) is <emu-val>true</emu-val>, return ?&nbsp;<emu-xref aoid="IteratorClose"><a href="https://tc39.es/ecma262/#sec-iteratorclose">IteratorClose</a></emu-xref>(<var>iterated</var>, <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<var>value</var>)).</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-iteratorprototype-@@tostringtag">
        <h1><span class="secnum">3.1.6.14</span> %Iterator.prototype% [ @@toStringTag ]</h1>
        <p>The initial value of the <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@toStringTag</a></emu-xref> property is the String value "<emu-xref href="#sec-iterator-constructor" id="_ref_67"><a href="#sec-iterator-constructor">Iterator</a></emu-xref>".</p>
        <p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>true</emu-val> }.</p>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-asynciteratorprototype">
      <h1><span class="secnum">3.1.7</span> The <dfn>%AsyncIterator.prototype%</dfn> Object</h1>

      <emu-clause id="sec-asynciteratorprototype.constructor">
        <h1><span class="secnum">3.1.7.1</span> %AsyncIterator.prototype%.constructor</h1>
        <p>The initial value of <emu-xref href="#sec-asynciteratorprototype" id="_ref_68"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.<emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref> is <emu-xref href="#sec-asynciterator-constructor" id="_ref_69"><a href="#sec-asynciterator-constructor">%AsyncIterator%</a></emu-xref>.</p>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.map">
        <h1><span class="secnum">3.1.7.2</span> %AsyncIterator.prototype%.map ( <var>mapper</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_70"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>mapper</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>mapper</var> and performs the following steps when called:<ol><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>value</var>, <var>lastValue</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>mapped</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>mapper</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_71"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>mapped</var>).</li><li>Set <var>mapped</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>mapped</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_72"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>mapped</var>).</li><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(<var>mapped</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_73"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateAsyncIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createasynciteratorfromclosure">CreateAsyncIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Async Iterator Helper</emu-const>, <emu-xref href="#sec-%asynciteratorhelperprototype%-object" id="_ref_74"><a href="#sec-%asynciteratorhelperprototype%-object">%AsyncIteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.filter">
        <h1><span class="secnum">3.1.7.3</span> %AsyncIterator.prototype%.filter ( <var>filterer</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_75"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>filterer</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>filterer</var> and performs the following steps when called:<ol><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>value</var>, <var>lastValue</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>selected</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>filterer</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_76"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>selected</var>).</li><li>Set <var>selected</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>selected</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_77"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>selected</var>).</li><li>If !&nbsp;<emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(<var>selected</var>) is <emu-val>true</emu-val>, then<ol><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(<var>value</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_78"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateAsyncIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createasynciteratorfromclosure">CreateAsyncIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Async Iterator Helper</emu-const>, <emu-xref href="#sec-%asynciteratorhelperprototype%-object" id="_ref_79"><a href="#sec-%asynciteratorhelperprototype%-object">%AsyncIteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.take">
        <h1><span class="secnum">3.1.7.4</span> %AsyncIterator.prototype%.take ( <var>limit</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_80"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>integerLimit</var> be ?&nbsp;<emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity">ToIntegerOrInfinity</a></emu-xref>(<var>limit</var>).</li><li>If <var>integerLimit</var> &lt; 0, throw a <emu-val>RangeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>integerLimit</var> and performs the following steps when called:<ol><li>Let <var>remaining</var> be <var>integerLimit</var>.</li><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>If <var>remaining</var> is 0, then<ol><li>Return ?&nbsp;<emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>iterated</var>, <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>undefined</emu-val>)).</li></ol></li><li>If <var>remaining</var> is not +∞, then<ol><li>Set <var>remaining</var> to <var>remaining</var> - 1.</li></ol></li><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(? <emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>)).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_81"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateAsyncIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createasynciteratorfromclosure">CreateAsyncIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Async Iterator Helper</emu-const>, <emu-xref href="#sec-%asynciteratorhelperprototype%-object" id="_ref_82"><a href="#sec-%asynciteratorhelperprototype%-object">%AsyncIteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.drop">
        <h1><span class="secnum">3.1.7.5</span> %AsyncIterator.prototype%.drop ( <var>limit</var> )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_83"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>integerLimit</var> be ?&nbsp;<emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity">ToIntegerOrInfinity</a></emu-xref>(<var>limit</var>).</li><li>If <var>integerLimit</var> &lt; 0, throw a <emu-val>RangeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>integerLimit</var> and performs the following steps when called:<ol><li>Let <var>remaining</var> be <var>integerLimit</var>.</li><li>Repeat, while <var>remaining</var> &gt; 0,<ol><li>If <var>remaining</var> is not +∞, then<ol><li>Set <var>remaining</var> to <var>remaining</var> - 1.</li></ol></li><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li></ol></li><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(? <emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>)).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_84"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateAsyncIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createasynciteratorfromclosure">CreateAsyncIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Async Iterator Helper</emu-const>, <emu-xref href="#sec-%asynciteratorhelperprototype%-object" id="_ref_85"><a href="#sec-%asynciteratorhelperprototype%-object">%AsyncIteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.asindexedpairs">
        <h1><span class="secnum">3.1.7.6</span> %AsyncIterator.prototype%.asIndexedPairs ( )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_86"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and performs the following steps when called:<ol><li>Let <var>index</var> be 0.</li><li>Let <var>lastValue</var> be <emu-val>undefined</emu-val>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>pair</var> be !&nbsp;<emu-xref aoid="CreateArrayFromList"><a href="https://tc39.es/ecma262/#sec-createarrayfromlist">CreateArrayFromList</a></emu-xref>(« <var>index</var>, <var>value</var> »).</li><li>Set <var>index</var> to <var>index</var> + 1.</li><li>Set <var>lastValue</var> to <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(<var>pair</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_87"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>lastValue</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateAsyncIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createasynciteratorfromclosure">CreateAsyncIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Async Iterator Helper</emu-const>, <emu-xref href="#sec-%asynciteratorhelperprototype%-object" id="_ref_88"><a href="#sec-%asynciteratorhelperprototype%-object">%AsyncIteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.flatmap">
        <h1><span class="secnum">3.1.7.7</span> %AsyncIterator.prototype%.flatMap ( <var>mapper</var> )</h1>
        <p><emu-xref href="#sec-asynciteratorprototype" id="_ref_89"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.flatMap is a built-in async generator function which, when called, performs the following steps:</p>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_90"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>mapper</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>closure</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>iterated</var> and <var>mapper</var> and performs the following steps when called:<ol><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>mapped</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>mapper</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_91"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>mapped</var>).</li><li>Set <var>mapped</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>mapped</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_92"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>mapped</var>).</li><li>Let <var>innerIterator</var> be <emu-xref aoid="GetIterator"><a href="https://tc39.es/ecma262/#sec-getiterator">GetIterator</a></emu-xref>(<var>mapped</var>, <emu-const>async</emu-const>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_93"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>innerIterator</var>, <var>iterated</var>).</li><li>Let <var>innerAlive</var> be <emu-val>true</emu-val>.</li><li>Repeat, while <var>innerAlive</var> is <emu-val>true</emu-val>,<ol><li>Let <var>innerNextPromise</var> be <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>innerIterator</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_94"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>innerNextPromise</var>, <var>iterated</var>).</li><li>Let <var>innerNext</var> be <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>innerNextPromise</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_95"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>innerNext</var>, <var>iterated</var>).</li><li>Let <var>innerComplete</var> be <emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>innerNext</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_96"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>innerComplete</var>, <var>iterated</var>).</li><li>If <var>innerComplete</var> is <emu-val>true</emu-val>, set <var>innerAlive</var> to <emu-val>false</emu-val>.</li><li>Else,<ol><li>Let <var>innerValue</var> be <emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>innerNext</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_97"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>innerValue</var>, <var>iterated</var>).</li><li>Let <var>yielded</var> be <emu-xref aoid="Yield"><a href="https://tc39.es/ecma262/#sec-yield">Yield</a></emu-xref>(<var>innerValue</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_98"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>yielded</var>, <var>iterated</var>).</li></ol></li></ol></li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="CreateAsyncIteratorFromClosure"><a href="https://tc39.es/ecma262/#sec-createasynciteratorfromclosure">CreateAsyncIteratorFromClosure</a></emu-xref>(<var>closure</var>, <emu-const>Async Iterator Helper</emu-const>, <emu-xref href="#sec-%asynciteratorhelperprototype%-object" id="_ref_99"><a href="#sec-%asynciteratorhelperprototype%-object">%AsyncIteratorHelperPrototype%</a></emu-xref>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.reduce">
        <h1><span class="secnum">3.1.7.8</span> %AsyncIterator.prototype%.reduce ( <var>reducer</var> [ , <var>initialValue</var> ] )</h1>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_100"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>reducer</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>initialValue</var> is not present, then<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>accumulator</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li></ol></li><li>Else,<ol><li>Let <var>accumulator</var> be <var>initialValue</var>.</li></ol></li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <var>accumulator</var>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>reducer</var>, <emu-val>undefined</emu-val>, « <var>accumulator</var>, <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_101"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>result</var>).</li><li>Set <var>result</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>result</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_102"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>result</var>).</li><li>Set <var>accumulator</var> to <var>result</var>.</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.toarray">
        <h1><span class="secnum">3.1.7.9</span> %AsyncIterator.prototype%.toArray ( )</h1>
        <p><emu-xref href="#sec-asynciteratorprototype" id="_ref_103"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.toArray is a built-in async function which, when called, performs the following steps:</p>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_104"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>Let <var>items</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return !&nbsp;<emu-xref aoid="CreateArrayFromList"><a href="https://tc39.es/ecma262/#sec-createarrayfromlist">CreateArrayFromList</a></emu-xref>(<var>items</var>).</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Append <var>value</var> to <var>items</var>.</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.foreach">
        <h1><span class="secnum">3.1.7.10</span> %AsyncIterator.prototype%.forEach ( <var>fn</var> )</h1>
        <p><emu-xref href="#sec-asynciteratorprototype" id="_ref_105"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.forEach is a built-in async function which, when called, performs the following steps:</p>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_106"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>fn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>r</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>fn</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_107"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>r</var>).</li><li>Set <var>r</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(r).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_108"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>r</var>).</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.some">
        <h1><span class="secnum">3.1.7.11</span> %AsyncIterator.prototype%.some ( <var>fn</var> )</h1>
        <p><emu-xref href="#sec-asynciteratorprototype" id="_ref_109"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.some is a built-in async function which, when called, performs the following steps:</p>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_110"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>fn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>false</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>fn</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_111"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>result</var>).</li><li>Set <var>result</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>result</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_112"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>result</var>).</li><li>If !&nbsp;<emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(<var>result</var>) is <emu-val>true</emu-val>, return ?&nbsp;<emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>iterated</var>, <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>true</emu-val>)).</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.every">
        <h1><span class="secnum">3.1.7.12</span> %AsyncIterator.prototype%.every ( <var>fn</var> )</h1>
        <p><emu-xref href="#sec-asynciteratorprototype" id="_ref_113"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.every is a built-in async function which, when called, performs the following steps:</p>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_114"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>fn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>true</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>fn</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_115"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>result</var>).</li><li>Set <var>result</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>result</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_116"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>result</var>).</li><li>If !&nbsp;<emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(<var>result</var>) is <emu-val>false</emu-val>, return ?&nbsp;<emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>iterated</var>, <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<emu-val>false</emu-val>)).</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype.find">
        <h1><span class="secnum">3.1.7.13</span> %AsyncIterator.prototype%.find ( <var>fn</var> )</h1>
        <p><emu-xref href="#sec-asynciteratorprototype" id="_ref_117"><a href="#sec-asynciteratorprototype">%AsyncIterator.prototype%</a></emu-xref>.find is a built-in async function which, when called, performs the following steps:</p>
        <emu-alg><ol><li>Let <var>iterated</var> be ?&nbsp;<emu-xref aoid="GetIteratorDirect" id="_ref_118"><a href="#sec-getiteratordirect">GetIteratorDirect</a></emu-xref>(<emu-val>this</emu-val> value).</li><li>If <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>fn</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Repeat,<ol><li>Let <var>next</var> be ?&nbsp;<emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(? <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>iterated</var>)).</li><li>If ?&nbsp;<emu-xref aoid="IteratorComplete"><a href="https://tc39.es/ecma262/#sec-iteratorcomplete">IteratorComplete</a></emu-xref>(<var>next</var>) is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="IteratorValue"><a href="https://tc39.es/ecma262/#sec-iteratorvalue">IteratorValue</a></emu-xref>(<var>next</var>).</li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>fn</var>, <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_119"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>result</var>).</li><li>Set <var>result</var> to <emu-xref aoid="Await"><a href="https://tc39.es/ecma262/#await">Await</a></emu-xref>(<var>result</var>).</li><li><emu-xref aoid="IfAbruptCloseAsyncIterator" id="_ref_120"><a href="#sec-ifabruptcloseasynciterator">IfAbruptCloseAsyncIterator</a></emu-xref>(<var>iterated</var>, <var>result</var>).</li><li>If !&nbsp;<emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(<var>result</var>) is <emu-val>true</emu-val>, return ?&nbsp;<emu-xref aoid="AsyncIteratorClose"><a href="https://tc39.es/ecma262/#sec-asynciteratorclose">AsyncIteratorClose</a></emu-xref>(<var>iterated</var>, <emu-xref aoid="NormalCompletion"><a href="https://tc39.es/ecma262/#sec-normalcompletion">NormalCompletion</a></emu-xref>(<var>value</var>)).</li></ol></li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-asynciteratorprototype-@@tostringtag">
        <h1><span class="secnum">3.1.7.14</span> %AsyncIterator.prototype% [ @@toStringTag ]</h1>
        <p>The initial value of the <emu-xref href="#sec-well-known-symbols"><a href="https://tc39.es/ecma262/#sec-well-known-symbols">@@toStringTag</a></emu-xref> property is the String value "Async <emu-xref href="#sec-iterator-constructor" id="_ref_121"><a href="#sec-iterator-constructor">Iterator</a></emu-xref>".</p>
        <p>This property has the attributes { [[Writable]]: <emu-val>false</emu-val>, [[Enumerable]]: <emu-val>false</emu-val>, [[Configurable]]: <emu-val>true</emu-val> }.</p>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-%asyncfromsynciteratorprototype%-object">
      <h1><span class="secnum">3.1.8</span> The %AsyncFromSyncIteratorPrototype% Object</h1>

      <emu-clause id="sec-%asyncfromsynciteratorprototype%.next">
        <h1><span class="secnum">3.1.8.1</span> %AsyncFromSyncIteratorPrototype%.next ( <var>value</var> )</h1>
        <emu-alg><ol><li>Let <var>O</var> be the <emu-val>this</emu-val> value.</li><li><del><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>O</var>) is Object and <var>O</var> has a [[SyncIteratorRecord]] internal slot.</del></li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li><ins>Let <var>check</var> be <emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[SyncIteratorRecord]]).</ins></li><li><ins><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>check</var>, <var>promiseCapability</var>).</ins></li><li>Let <var>syncIteratorRecord</var> be <var>O</var>.[[SyncIteratorRecord]].</li><li>Let <var>result</var> be <emu-xref aoid="IteratorNext"><a href="https://tc39.es/ecma262/#sec-iteratornext">IteratorNext</a></emu-xref>(<var>syncIteratorRecord</var>, <var>value</var>).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li><li>Return !&nbsp;<emu-xref aoid="AsyncFromSyncIteratorContinuation"><a href="https://tc39.es/ecma262/#sec-asyncfromsynciteratorcontinuation">AsyncFromSyncIteratorContinuation</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-%asyncfromsynciteratorprototype%.return">
        <h1><span class="secnum">3.1.8.2</span> %AsyncFromSyncIteratorPrototype%.return ( <var>value</var> )</h1>

        <emu-alg><ol><li>Let <var>O</var> be the <emu-val>this</emu-val> value.</li><li><del><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>O</var>) is Object and <var>O</var> has a [[SyncIteratorRecord]] internal slot.</del></li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li><ins>Let <var>check</var> be <emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[SyncIteratorRecord]]).</ins></li><li><ins><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>check</var>, <var>promiseCapability</var>).</ins></li><li>Let <var>return</var> be <emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>syncIterator</var>, <emu-val>"return"</emu-val>).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>return</var>, <var>promiseCapability</var>).</li><li>If <var>return</var> is <emu-val>undefined</emu-val>, then<ol><li>Let <var>iterResult</var> be !&nbsp;<emu-xref aoid="CreateIterResultObject"><a href="https://tc39.es/ecma262/#sec-createiterresultobject">CreateIterResultObject</a></emu-xref>(<var>value</var>, <emu-val>true</emu-val>).</li><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, « <var>iterResult</var> »).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>return</var>, <var>syncIterator</var>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li><li>If <emu-xref aoid="Type"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>result</var>) is not Object, then<ol><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, « a newly created <emu-val>TypeError</emu-val> object »).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></li><li>Return !&nbsp;<emu-xref aoid="AsyncFromSyncIteratorContinuation"><a href="https://tc39.es/ecma262/#sec-asyncfromsynciteratorcontinuation">AsyncFromSyncIteratorContinuation</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-%asyncfromsynciteratorprototype%.throw">
        <h1><span class="secnum">3.1.8.3</span> %AsyncFromSyncIteratorPrototype%.throw ( <var>value</var> )</h1>

        <emu-alg><ol><li>Let <var>O</var> be the <emu-val>this</emu-val> value.</li><li><del><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="Type"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>O</var>) is Object and <var>O</var> has a [[SyncIteratorRecord]] internal slot.</del></li><li>Let <var>promiseCapability</var> be !&nbsp;<emu-xref aoid="NewPromiseCapability"><a href="https://tc39.es/ecma262/#sec-newpromisecapability">NewPromiseCapability</a></emu-xref>(<emu-xref href="#sec-promise-constructor"><a href="https://tc39.es/ecma262/#sec-promise-constructor">%Promise%</a></emu-xref>).</li><li><ins>Let <var>check</var> be <emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>O</var>, [[SyncIteratorRecord]]).</ins></li><li><ins><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>check</var>, <var>promiseCapability</var>).</ins></li><li>Let <var>syncIterator</var> be <var>O</var>.[[SyncIteratorRecord]].[[Iterator]].</li><li>Let <var>throw</var> be <emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod">GetMethod</a></emu-xref>(<var>syncIterator</var>, <emu-val>"throw"</emu-val>).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>throw</var>, <var>promiseCapability</var>).</li><li>If <var>throw</var> is <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, « <var>value</var> »).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></li><li>Let <var>result</var> be <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>throw</var>, <var>syncIterator</var>, « <var>value</var> »).</li><li><emu-xref aoid="IfAbruptRejectPromise"><a href="https://tc39.es/ecma262/#sec-ifabruptrejectpromise">IfAbruptRejectPromise</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li><li>If <emu-xref aoid="Type"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>result</var>) is not Object, then<ol><li>Perform !&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, « a newly created <emu-val>TypeError</emu-val> object »).</li><li>Return <var>promiseCapability</var>.[[Promise]].</li></ol></li><li>Return !&nbsp;<emu-xref aoid="AsyncFromSyncIteratorContinuation"><a href="https://tc39.es/ecma262/#sec-asyncfromsynciteratorcontinuation">AsyncFromSyncIteratorContinuation</a></emu-xref>(<var>result</var>, <var>promiseCapability</var>).</li></ol></emu-alg>
      </emu-clause>
    </emu-clause>
  </emu-clause>
</emu-clause>
</div></body>